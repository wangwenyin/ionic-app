Autodesk.Extensions.ZoomWindow=function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}({0:function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=c(29),i=function(a){return a&&a.__esModule?a:{default:a}}(h),j=Autodesk.Viewing,k=(j.Private,AutodeskNamespace("Autodesk.Viewing.Extensions.ZoomWindow")),l=function(a){function b(a,c){d(this,b);var f=e(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a,c));return Autodesk.Viewing.Extension.call(f,a,c),f.createUIBound=function(){a.removeEventListener(j.TOOLBAR_CREATED_EVENT,this.createUIBound),this.createUI(this.viewer.getToolbar(!1))}.bind(f),f.name="zoomwindow",f.modes=["zoomwindow","dolly"],f}return f(b,a),g(b,[{key:"load",value:function(){var a=this.viewer;return this.tool=new i.default(a),a.toolController.registerTool(this.tool),this.createUI(a.getToolbar(!1)),!0}},{key:"createUI",value:function(a){var b;if(!a||!(b=a.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID))||!b.dollybutton)return void this.viewer.addEventListener(j.TOOLBAR_CREATED_EVENT,this.createUIBound);var c=this;b.removeControl(b.dollybutton.getId()),this.defaultDollyButton=b.dollybutton,this.zoomWindowToolButton=new Autodesk.Viewing.UI.ComboButton("toolbar-zoomTools"),this.zoomWindowToolButton.setIcon("zoomwindowtoolicon-zoom-window"),this.zoomWindowToolButton.setToolTip("Zoom window"),this.createZoomSubmenu(this.zoomWindowToolButton),b.addControl(this.zoomWindowToolButton);var d=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],onRelease:function(){c.zoomWindowToolButton.getState()===Autodesk.Viewing.UI.Button.State.ACTIVE&&(c.viewer.setActiveNavigationTool(),c.zoomWindowToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}}];this.viewer.getHotkeyManager().pushHotkeys(this.escapeHotkeyId,d)}},{key:"destroyUI",value:function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID);c&&(this.zoomWindowToolButton&&(this.zoomWindowToolButton.subMenu.removeEventListener(Autodesk.Viewing.UI.RadioButtonGroup.Event.ACTIVE_BUTTON_CHANGED,this.zoomWindowToolButton.subMenuActiveButtonChangedHandler(c)),c.removeControl(this.zoomWindowToolButton.getId())),this.zoomWindowToolButton=null,c.panbutton&&this.defaultDollyButton?c.addControl(this.defaultDollyButton):this.defaultDollyButton=null)}a.getHotkeyManager().popHotkeys(this.escapeHotkeyId)}},{key:"createZoomSubmenu",value:function(a){var b=function(a,b,c){return function(){var d=b.getState();d===Autodesk.Viewing.UI.Button.State.INACTIVE?(a.activate(c),b.setState(Autodesk.Viewing.UI.Button.State.ACTIVE)):d===Autodesk.Viewing.UI.Button.State.ACTIVE&&(a.deactivate(),b.setState(Autodesk.Viewing.UI.Button.State.INACTIVE))}},c=this.viewer,d=c.getToolbar(!0),e=(d.getControl(Autodesk.Viewing.TOOLBAR.NAVTOOLSID),new Autodesk.Viewing.UI.Button("toolbar-zoomWindowTool"));e.setToolTip(Autodesk.Viewing.i18n.translate("Zoom window")),e.setIcon("zoomwindowtoolicon-zoom-window"),e.onClick=b(this,e,"zoomwindow"),a.addControl(e);var f=new Autodesk.Viewing.UI.Button("toolbar-zoomTool");f.setToolTip("Zoom"),f.setIcon("adsk-icon-zoom"),f.onClick=b(this,f,"dolly"),a.addControl(f)}},{key:"unload",value:function(){var a=this.viewer;return"dolly"!==a.getActiveNavigationTool()&&"zoomwindow"!==a.getActiveNavigationTool()||a.setActiveNavigationTool(),this.destroyUI(),a.toolController.deregisterTool(this.tool),this.tool=null,!0}},{key:"activate",value:function(a){if(!this.activeStatus||this.mode!==a){switch(a){default:case"zoomwindow":this.viewer.setActiveNavigationTool("zoomwindow"),this.mode="zoomwindow";break;case"dolly":this.viewer.setActiveNavigationTool("dolly"),this.mode="dolly"}return this.activeStatus=!0,!0}}},{key:"deactivate",value:function(){return this.activeStatus&&(this.viewer.setActiveNavigationTool(),this.activeStatus=!1),!0}}]),b}(j.Extension);b.default=l,k.ZoomWindow=l,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Viewing.ZoomWindow",l)},29:function(a,b){"use strict";function c(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var d=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),e=function(){function a(b){c(this,a),this._names=["zoomwindow"],this._isActive=!1,this._isDragging=!1,this._mouseStart=new THREE.Vector3(0,0,-10),this._mouseEnd=new THREE.Vector3(0,0,-10),this.materialLine=null,this.lineGeom=null,this.crossGeomX=null,this.crossGeomY=null,this.rectGroup=null,this.viewer=b,this._camera=this.viewer.navigation.getCamera()}return d(a,[{key:"isActive",value:function(){return this._isActive}},{key:"getNames",value:function(){return this._names}},{key:"getName",value:function(){return this._names[0]}},{key:"onResize",value:function(){this.rectGroup=null;var a=this.viewer.canvas,b=a.clientWidth,c=a.clientHeight,d=new THREE.OrthographicCamera(0,b,0,c,1,1e3);this.viewer.impl.overlayScenes.ZoomWindowRect.camera=d}},{key:"activate",value:function(a){if(this._isActive=!0,null===this.materialLine){var b=null;b=this.viewer.navigation.getIs2D()?new THREE.Color(0):new THREE.Color(16777215),this.materialLine=new THREE.LineBasicMaterial({color:b,opacity:.6,linewidth:1,depthTest:!1,depthWrite:!1}),this.materialLine.doNotCut=!0}var c=this.viewer.canvas,d=c.clientWidth,e=c.clientHeight,f=new THREE.OrthographicCamera(0,d,0,e,1,1e3);this.viewer.impl.createOverlayScene("ZoomWindowRect",this.materialLine,this.materialLine,f),this.viewer.impl.api.addEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),this.viewer.toolController.getTool("dolly").activate("orbit")}},{key:"deactivate",value:function(a){this.rectGroup=null,this.viewer.impl.removeOverlayScene("ZoomWindowRect"),this._isActive=!1,this._isDragging=!1,this._mouseStart.set(0,0,-10),this._mouseEnd.set(0,0,-10),this.viewer.impl.api.removeEventListener(Autodesk.Viewing.VIEWER_RESIZE_EVENT,this.onResize),this.viewer.toolController.getTool("dolly").deactivate("orbit")}},{key:"getCursor",value:function(){switch(this.viewer.toolController.getTool("dolly").getTriggeredMode()){case"dolly":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAAAgVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD///8mJiYAAADNzc2/v7+fn59paWlPT08MDAwICAj6+vqpqak7Ozv29vby8vLp6em2traAgIBkZGRZWVlAQEAaGhpISEgkS7tbAAAAFHRSTlMAOvhpZD8mkQWegMy9qY1YVE01EYiqlE0AAADZSURBVCjPbY9ZloMgEAAbEbfsmRZZXbJn7n/AAX2RQVN/VD26AXLOeZLDGo6IbfI9tHq8cdxuj1HwvgCoaiHqKoRk+M3hB9jueUW8PnfsE/bJ3vms7nCkq7NoE3s99AXxoh8vFoXCpknrn5faAuJCenT0xPkYqnxQFJaU0gdZrsKm8aHZrAIffBj40mc1jsTfIJRWegq6opTMvlfqLqYg7kr1ZB7jFgeaMC59N//8O4WZ1IiPF8b5wMHcJn8zB4g4mc77zpxgAbMSUVoGK4iV0hL4wrksz+H0Bw5+E+HrniDQAAAAAElFTkSuQmCC), auto";case"pan":return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAMAAADXqc3KAAABHVBMVEUAAABPTk4AAAAAAAAJCQkRERE0MzQQEBAODg4QEBB4d3dbWlo9PDw/Pj4vLy8sLCwZGBgWFhYcHBwKCgoSEhIAAAAKCgoICAgKCgoQEBAODg4EBAQICAgPDw8REREMDAx2dnY0NDQvLy9QUFAaGhomJSYjIyM7OjokJCQNDA0mJiYNDQ0AAAAUFBQJCQkQEBAEBAQNDQ0PDw8VFRX///+amJkAAAD5+fnz8/PKycn9/f339vbi4eLR0dDNzMyAgIB8e3xycHH7+/vw7+/o6OjX1ta7urq4t7iwsLCnp6eioqKbmppva21OTk74+Pjl5eXc3Nzb29vLy8vDw8PDwsKrqqqdnZ2WlpaSkpKTkZKMiouEg4NkZGRISEgxLzBpgbsEAAAANHRSTlMA+fiQXgngKSYG/vX17uvBuqackpCNg3BpUkpAPBwTDvj18+vl0s/NwrOwoZZ+TDg4NBkBGrzX8QAAAP5JREFUKM99j9Vuw0AQRdeuKZyGkyZNmbnXDLHDVGb8/8/oy7paK1bO0+oc7WiGnGiaxq+QRTQAOh8f9Jv4H/Ge8PZPrCdlvkxfYluUT2WyyCq3mZ7unwlKVLcqOzA/Mf71j0TWJ/Ym6rPeca05Ni4iIevYc7yoUD2zQFhq71BdI9nvBeBabFDSPe8DswlUc1Riw3VxbH0NHBUPQ0jrbDnPYDjALQBMq9E7nkC5y7VDKTZlUg8Q0lmjvl74zlYErgvKa42GPKf3/a0kQmYCDY1SYMDosqMoiWrGwz/uAbNvc/fNon4kXRKGq+PUo2Mb96afV0iUxqGU2s4VBbKUP65NL/LKF+7ZAAAAAElFTkSuQmCC), auto"}return"url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAADWSURBVEiJ1ZVNEsIwCEYfTg/UjTPuemcvojfCRRMlNKGdKguZyaLkK4/8EERVybQJQERCUU3C63p+n/Bk9QHDRtbIX2GqKh6woRfxLdL0/M1KzYRaA+7AXDW9wN5fvrXEWud6AOABLD7QwREDgCdw7WV6ZjSAsi0Lzn4JmEcHeHbYWxQXw3FTEWmvaWY1X9Iie4CIKHE1fwfIsnSAZD/X/79FGbdISyzA9QMDG3axTTTVwx3NaNbm5B2dRHY1DWCUyd4qIs0bUB8nuz32/11Cu+KPM7sOXlrOS4sOkzb1AAAAAElFTkSuQmCC), auto"}},{key:"handleGesture",value:function(a){switch(a.type){case"dragstart":return this.handleButtonDown(a,0);case"dragmove":return this.handleMouseMove(a);case"dragend":return this.handleButtonUp(a,0)}return!1}},{key:"handleSingleClick",value:function(a,b){return!0}},{key:"startDrag",value:function(a){if(!1===this._isDragging){if(this._isDragging=!0,this._mouseStart.x=a.canvasX,this._mouseStart.y=a.canvasY,this._mouseEnd.x=a.canvasX,this._mouseEnd.y=a.canvasY,null===this.rectGroup){this.lineGeom=new THREE.Geometry,this.lineGeom.vertices.push(this._mouseStart.clone(),this._mouseStart.clone(),this._mouseStart.clone(),this._mouseStart.clone(),this._mouseStart.clone()),this.crossGeomX=new THREE.Geometry,this.crossGeomX.vertices.push(this._mouseStart.clone(),this._mouseStart.clone()),this.crossGeomY=new THREE.Geometry,this.crossGeomY.vertices.push(this._mouseStart.clone(),this._mouseStart.clone());var b=new THREE.Line(this.lineGeom,this.materialLine,THREE.LineStrip),c=new THREE.Line(this.crossGeomX,this.materialLine,THREE.LineStrip),d=new THREE.Line(this.crossGeomY,this.materialLine,THREE.LineStrip);this.rectGroup=new THREE.Group,this.rectGroup.add(b),this.rectGroup.add(c),this.rectGroup.add(d)}else this.lineGeom.vertices[0]=this._mouseStart.clone(),this.lineGeom.vertices[1]=this._mouseStart.clone(),this.lineGeom.vertices[2]=this._mouseStart.clone(),this.lineGeom.vertices[3]=this._mouseStart.clone(),this.lineGeom.vertices[4]=this._mouseStart.clone(),this.crossGeomX.vertices[0]=this._mouseStart.clone(),this.crossGeomX.vertices[1]=this._mouseStart.clone(),this.crossGeomY.vertices[0]=this._mouseStart.clone(),this.crossGeomY.vertices[1]=this._mouseStart.clone(),this.crossGeomX.verticesNeedUpdate=!0,this.crossGeomY.verticesNeedUpdate=!0,this.lineGeom.verticesNeedUpdate=!0;this.viewer.impl.addOverlay("ZoomWindowRect",this.rectGroup)}}},{key:"handleButtonDown",value:function(a,b){return 0===b&&(this.startDrag(a),!0)}},{key:"handleMouseMove",value:function(a){return!(!this.lineGeom||!this._isDragging)&&(this._mouseEnd.x=a.canvasX,this._mouseEnd.y=a.canvasY,!0)}},{key:"endDrag",value:function(a){!0===this._isDragging&&(this.viewer.impl.removeOverlay("ZoomWindowRect",this.rectGroup),this._isDragging=!1)}},{key:"handleButtonUp",value:function(a,b){return 0===b&&(this.endDrag(),!0)}},{key:"handleKeyDown",value:function(a,b){return!1}},{key:"handleKeyUp",value:function(a,b){return!1}},{key:"handleWheelInput",value:function(a){return!1}},{key:"handleSingleClick",value:function(a,b){return!1}},{key:"handleDoubleClick",value:function(a,b){return!1}},{key:"handleSingleTap",value:function(a){return!1}},{key:"handleDoubleTap",value:function(a){return!1}},{key:"handleBlur",value:function(a){return!1}},{key:"update",value:function(){if(this.isActive()){if(!this.lineGeom||!this._isDragging)return this.zoomWindow();this.lineGeom.vertices[1].x=this._mouseStart.x,this.lineGeom.vertices[1].y=this._mouseEnd.y,this.lineGeom.vertices[2]=this._mouseEnd.clone(),this.lineGeom.vertices[3].x=this._mouseEnd.x,this.lineGeom.vertices[3].y=this._mouseStart.y,this.lineGeom.vertices[4]=this.lineGeom.vertices[0];var a=Math.abs(this._mouseEnd.x-this._mouseStart.x),b=Math.abs(this._mouseEnd.y-this._mouseStart.y),c=a>b?b:a;c>20&&(c=20);var d=.5*c,e=[.5*(this._mouseEnd.x+this._mouseStart.x),.5*(this._mouseEnd.y+this._mouseStart.y)];return this.crossGeomX.vertices[0].x=e[0]-d,this.crossGeomX.vertices[0].y=e[1],this.crossGeomX.vertices[1].x=e[0]+d,this.crossGeomX.vertices[1].y=e[1],this.crossGeomY.vertices[0].x=e[0],this.crossGeomY.vertices[0].y=e[1]-d,this.crossGeomY.vertices[1].x=e[0],this.crossGeomY.vertices[1].y=e[1]+d,this.crossGeomX.verticesNeedUpdate=!0,this.crossGeomY.verticesNeedUpdate=!0,this.lineGeom.verticesNeedUpdate=!0,this.viewer.impl.invalidate(!1,!1,!0),!1}}},{key:"getPivot",value:function(a,b,c,d,e){a=2*a/c-1,b=1-2*b/d;var f=new THREE.Vector3(a,b,-1),g=new THREE.Vector3(a,b,1);f.unproject(e),g.unproject(e),g.sub(f);var h=e.position,i=e.target,j=i.clone().sub(h).normalize(),k=(j.dot(i)-j.dot(f))/j.dot(g);return f.add(g.multiplyScalar(k)),f}},{key:"queryMouseRaySceneIntersection",value:function(a,b){if(null==this.viewer)return null;if(null==this.viewer.model)return null;if(this.viewer.model.is2d())return null;var c=this.viewer.impl.hitTest(a,b,!1);return c?c.intersectPoint:null}},{key:"zoomWindow",value:function(){var a=this._camera,b=this.viewer.canvas.clientWidth,c=this.viewer.canvas.clientHeight,d=this._mouseStart.x,e=this._mouseStart.y,f=this._mouseEnd.x,g=this._mouseEnd.y,h=Math.abs(f-d),i=Math.abs(g-e);if(0===h||0===i)return!1;if(this._mouseEnd.copy(this._mouseStart),this.viewer.navigation.getIs2D()){var j={x:.5*(d+f),y:.5*(e+g)},k=this.viewer.navigation.getEyeVector().length(),l=this.viewer.impl.clientToViewport(j.x,j.y),m=this.viewer.impl.clientToViewport(b/2,c/2);l.subVectors(l,m),this.viewer.navigation.panRelative(l.x/2,l.y/2,k);var n=h/b,o=i/c,p=n>o?n:o;k=this.viewer.navigation.getEyeVector().length();var q=this.viewer.navigation.getWorldPoint(.5,.5);return this.viewer.navigation.dollyFromPoint(k*(p-1),q),!0}var r=null,s=.5*(d+f),t=.5*(e+g);null===(r=this.queryMouseRaySceneIntersection(s,t))&&(r=this.getPivot(s,t,b,c,this._camera));var u=a.position,v=a.target.clone().sub(u);v.normalize();var w=Math.min(b/h,c/i),x=r.distanceTo(u),y=1*x/w;return v.multiplyScalar(-y),v.add(r),a.position.set(v.x,v.y,v.z),a.target.set(r.x,r.y,r.z),a.dirty=!0,!0}}]),a}();b.default=e}});
//# sourceMappingURL=ZoomWindow.min.js.map