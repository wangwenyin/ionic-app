function init_TransformGizmos(){"use strict";var a=function(a){THREE.MeshBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.side=THREE.FrontSide,this.transparent=!0,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};a.prototype=Object.create(THREE.MeshBasicMaterial.prototype);var b=function(a){THREE.LineBasicMaterial.call(this),this.depthTest=!1,this.depthWrite=!1,this.transparent=!0,this.linewidth=1,this.setValues(a),this.oldColor=this.color.clone(),this.oldOpacity=this.opacity,this.highlight=function(a){a?(this.color.setRGB(1,230/255,3/255),this.opacity=1):(this.color.copy(this.oldColor),this.opacity=this.oldOpacity)}};b.prototype=Object.create(THREE.LineBasicMaterial.prototype),void 0===THREE.PolyhedronGeometry&&(THREE.PolyhedronGeometry=function(a,b,c,d){function e(a){var b=a.normalize().clone();b.index=j.vertices.push(b)-1;var c=g(a)/2/Math.PI+.5,d=h(a)/Math.PI+.5;return b.uv=new THREE.Vector2(c,1-d),b}function f(a,b,c){var d=new THREE.Face3(a.index,b.index,c.index,[a.clone(),b.clone(),c.clone()]);j.faces.push(d),s.copy(a).add(b).add(c).divideScalar(3);var e=g(s);j.faceVertexUvs[0].push([i(a.uv,a,e),i(b.uv,b,e),i(c.uv,c,e)])}function g(a){return Math.atan2(a.z,-a.x)}function h(a){return Math.atan2(-a.y,Math.sqrt(a.x*a.x+a.z*a.z))}function i(a,b,c){return c<0&&1===a.x&&(a=new THREE.Vector2(a.x-1,a.y)),0===b.x&&0===b.z&&(a=new THREE.Vector2(c/2/Math.PI+.5,a.y)),a.clone()}THREE.Geometry.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:a,indices:b,radius:c,detail:d},c=c||1,d=d||0;for(var j=this,k=0,l=a.length;k<l;k+=3)e(new THREE.Vector3(a[k],a[k+1],a[k+2]));for(var m=this.vertices,n=[],k=0,o=0,l=b.length;k<l;k+=3,o++){var p=m[b[k]],q=m[b[k+1]],r=m[b[k+2]];n[o]=new THREE.Face3(p.index,q.index,r.index,[p.clone(),q.clone(),r.clone()])}for(var s=new THREE.Vector3,k=0,l=n.length;k<l;k++)!function(a,b){for(var c=Math.pow(2,b),d=(Math.pow(4,b),e(j.vertices[a.a])),g=e(j.vertices[a.b]),h=e(j.vertices[a.c]),i=[],k=0;k<=c;k++){i[k]=[];for(var l=e(d.clone().lerp(h,k/c)),m=e(g.clone().lerp(h,k/c)),n=c-k,o=0;o<=n;o++)i[k][o]=0==o&&k==c?l:e(l.clone().lerp(m,o/n))}for(var k=0;k<c;k++)for(var o=0;o<2*(c-k)-1;o++){var p=Math.floor(o/2);o%2==0?f(i[k][p+1],i[k+1][p],i[k][p]):f(i[k][p+1],i[k+1][p+1],i[k+1][p])}}(n[k],d);for(var k=0,l=this.faceVertexUvs[0].length;k<l;k++){var t=this.faceVertexUvs[0][k],u=t[0].x,v=t[1].x,w=t[2].x,x=Math.max(u,Math.max(v,w)),y=Math.min(u,Math.min(v,w));x>.9&&y<.1&&(u<.2&&(t[0].x+=1),v<.2&&(t[1].x+=1),w<.2&&(t[2].x+=1))}for(var k=0,l=this.vertices.length;k<l;k++)this.vertices[k].multiplyScalar(c);this.mergeVertices(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,c)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.OctahedronGeometry&&(THREE.OctahedronGeometry=function(a,b){this.parameters={radius:a,detail:b};var c=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],d=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];THREE.PolyhedronGeometry.call(this,c,d,a,b),this.type="OctahedronGeometry",this.parameters={radius:a,detail:b}},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype)),void 0===THREE.TorusGeometry&&(THREE.TorusGeometry=function(a,b,c,d,e){THREE.Geometry.call(this),this.type="TorusGeometry",this.parameters={radius:a,tube:b,radialSegments:c,tubularSegments:d,arc:e},a=a||100,b=b||40,c=c||8,d=d||6,e=e||2*Math.PI;for(var f=new THREE.Vector3,g=[],h=[],i=0;i<=c;i++)for(var j=0;j<=d;j++){var k=j/d*e,l=i/c*Math.PI*2;f.x=a*Math.cos(k),f.y=a*Math.sin(k);var m=new THREE.Vector3;m.x=(a+b*Math.cos(l))*Math.cos(k),m.y=(a+b*Math.cos(l))*Math.sin(k),m.z=b*Math.sin(l),this.vertices.push(m),g.push(new THREE.Vector2(j/d,i/c)),h.push(m.clone().sub(f).normalize())}for(var i=1;i<=c;i++)for(var j=1;j<=d;j++){var n=(d+1)*i+j-1,o=(d+1)*(i-1)+j-1,p=(d+1)*(i-1)+j,q=(d+1)*i+j,r=new THREE.Face3(n,o,q,[h[n].clone(),h[o].clone(),h[q].clone()]);this.faces.push(r),this.faceVertexUvs[0].push([g[n].clone(),g[o].clone(),g[q].clone()]),r=new THREE.Face3(o,p,q,[h[o].clone(),h[p].clone(),h[q].clone()]),this.faces.push(r),this.faceVertexUvs[0].push([g[o].clone(),g[p].clone(),g[q].clone()])}this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype));var c=function(a,b,c){var d=new THREE.Geometry;c=c||1;for(var e=0;e<=64*c;++e)"x"==b&&d.vertices.push(new THREE.Vector3(0,Math.cos(e/32*Math.PI),Math.sin(e/32*Math.PI)).multiplyScalar(a)),"y"==b&&d.vertices.push(new THREE.Vector3(Math.cos(e/32*Math.PI),0,Math.sin(e/32*Math.PI)).multiplyScalar(a)),"z"==b&&d.vertices.push(new THREE.Vector3(Math.sin(e/32*Math.PI),Math.cos(e/32*Math.PI),0).multiplyScalar(a));return d},d=function(a,b,c,d,e,f){var g=new THREE.Geometry,h=new THREE.Mesh(new THREE.CylinderGeometry(a,b,c,d,e,f));return h.position.y=.5,h.updateMatrix(),g.merge(h.geometry,h.matrix),g},e=function(a){var b=new THREE.Geometry;return"X"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(1,0,0)):"Y"===a?b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,1,0)):"Z"===a&&b.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),b};THREE.TransformGizmo=function(){var a=this;this.init=function(){THREE.Object3D.call(this),this.handles=new THREE.Object3D,this.pickers=new THREE.Object3D,this.planes=new THREE.Object3D,this.highlights=new THREE.Object3D,this.hemiPicker=new THREE.Object3D,this.subPickers=new THREE.Object3D,this.add(this.handles),this.add(this.pickers),this.add(this.planes),this.add(this.highlights),this.add(this.hemiPicker),this.add(this.subPickers);var a=new THREE.PlaneBufferGeometry(50,50,2,2),b=new THREE.MeshBasicMaterial({wireframe:!0});b.side=THREE.DoubleSide;var c={XY:new THREE.Mesh(a,b),YZ:new THREE.Mesh(a,b),XZ:new THREE.Mesh(a,b),XYZE:new THREE.Mesh(a,b)};this.activePlane=c.XYZE,c.YZ.rotation.set(0,Math.PI/2,0),c.XZ.rotation.set(-Math.PI/2,0,0);for(var d in c)c[d].name=d,this.planes.add(c[d]),this.planes[d]=c[d],c[d].visible=!1;this.setupGizmos(),this.activeMode="",this.traverse(function(a){if(a instanceof THREE.Mesh){a.updateMatrix();var b=new THREE.Geometry;a.geometry instanceof THREE.BufferGeometry&&(a.geometry=(new THREE.Geometry).fromBufferGeometry(a.geometry)),b.merge(a.geometry,a.matrix),a.geometry=b,a.position.set(0,0,0),a.rotation.set(0,0,0),a.scale.set(1,1,1)}})},this.hide=function(){this.traverse(function(a){a.visible=!1})},this.show=function(){this.traverse(function(b){b.visible=!0,b.parent!=a.pickers&&b.parent!=a.hemiPicker||(b.visible=!1),b.parent==a.planes&&(b.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(a){this.traverse(function(b){b.material&&b.material.highlight&&(b.name==a?b.material.highlight(!0):b.material.highlight(!1))})},this.setupGizmos=function(){var a=function(a,b){for(var c in a)for(var d=a[c].length;d--;){var e=a[c][d][0],f=a[c][d][1],g=a[c][d][2],h=a[c][d][3];e.name=c,f&&e.position.set(f[0],f[1],f[2]),g&&e.rotation.set(g[0],g[1],g[2]),h&&(e.visble=h),b.add(e)}};this.setHandlePickerGizmos(),a(this.handleGizmos,this.handles),a(this.pickerGizmos,this.pickers),a(this.highlightGizmos,this.highlights),a(this.hemiPickerGizmos,this.hemiPicker),a(this.subPickerGizmos,this.subPickers),this.hide(),this.show()}},THREE.TransformGizmo.prototype=Object.create(THREE.Object3D.prototype),THREE.TransformGizmo.prototype.update=function(a,b){var c=new THREE.Vector3(0,0,0),d=new THREE.Vector3(0,1,0),e=new THREE.Matrix4;this.traverse(function(f){f.name&&(-1!=f.name.search("E")?f.quaternion.setFromRotationMatrix(e.lookAt(b,c,d)):-1==f.name.search("X")&&-1==f.name.search("Y")&&-1==f.name.search("Z")||f.quaternion.setFromEuler(a))})},THREE.TransformGizmoTranslate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(0,.05,.2,12,1,!1),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:15805484})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:15805484}))]],Y:[[new THREE.Mesh(c,new a({color:768011})),[0,.5,0]],[new THREE.Line(g,new b({color:768011}))]],Z:[[new THREE.Mesh(c,new a({color:2895089})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:2895089}))]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.1,0),new a({color:16777215,opacity:.25})),[0,0,0],[0,0,0]]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16776960,opacity:.25})),[.15,.15,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:65535,opacity:.25})),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.29,.29),new a({color:16711935,opacity:.25})),[.15,0,.15],[-Math.PI/2,0,0]]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.OctahedronGeometry(.2,0),new a({color:16777215,opacity:.25}))]],XY:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16776960,opacity:.25})),[.2,.2,0]]],YZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:65535,opacity:.25})),[0,.2,.2],[0,Math.PI/2,0]]],XZ:[[new THREE.Mesh(new THREE.PlaneBufferGeometry(.4,.4),new a({color:16711935,opacity:.25})),[.2,0,.2],[-Math.PI/2,0,0]]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(1.2,1.2,1.2),new a({color:255})),[.5,.5,.5],null,!1]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),"XY"==a&&(this.activePlane=this.planes.XY),"YZ"==a&&(this.activePlane=this.planes.YZ),"XZ"==a&&(this.activePlane=this.planes.XZ),this.hide(),this.show()},this.init()},THREE.TransformGizmoTranslate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoRotate=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){this.handleGizmos={RX:[[new THREE.Line(c(1,"x",.5),new b({color:16711680}))]],RY:[[new THREE.Line(c(1,"y",.5),new b({color:65280}))]],RZ:[[new THREE.Line(c(1,"z",.5),new b({color:255}))]],RE:[[new THREE.Line(c(1.25,"z",1),new b({color:65535}))]],RXYZE:[[new THREE.Line(c(1,"z",1),new b({color:16711935}))]]},this.pickerGizmos={RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:65280,opacity:.25})),[0,0,0],[Math.PI/2,0,0]]],RZ:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,Math.PI),new a({color:255,opacity:.25})),[0,0,0],[0,0,-Math.PI/2]]],RE:[[new THREE.Mesh(new THREE.TorusGeometry(1.25,.12,2,24),new a({color:65535,opacity:.25}))]],RXYZE:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,2,24),new a({color:16711935,opacity:.25}))]]}},this.setActivePlane=function(a){"RE"==a&&(this.activePlane=this.planes.XYZE),"RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY),this.hide(),this.show()},this.update=function(a,b){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})},this.init()},THREE.TransformGizmoRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoTranslateRotate=function(){THREE.TransformGizmo.call(this);var b=this;this.setHandlePickerGizmos=function(){var b=d(0,.05,.2,12,1,!1);(new THREE.Geometry).vertices.push(new THREE.Vector3(0,0,-.1),new THREE.Vector3(0,0,.1),new THREE.Vector3(-.1,0,0),new THREE.Vector3(.1,0,0));this.handleGizmos={Z:[[new THREE.Mesh(b,new a({color:16777215})),[0,0,.25],[Math.PI/2,0,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.015,.015,.6,4,1,!1),new a({color:16777215})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:16711680})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.015,60,1,!1),new a({color:16711680})),[0,0,1],[Math.PI/2,0,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.015,12,60,.3*Math.PI),new a({color:255})),[0,0,0],[Math.PI/2,0,.35*Math.PI]],[new THREE.Mesh(new THREE.CylinderGeometry(.05,.05,.01,60,1,!1),new a({color:255})),[0,0,1]]]},this.pickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:16711680,opacity:.25})),[0,0,0],[.15*Math.PI,-Math.PI/2,0]]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.12,4,12,.3*Math.PI),new a({color:255,opacity:.25})),[0,0,0],[Math.PI/2,0,.35*Math.PI]]]},this.subPickerGizmos={Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.12,.12,.65,4,1,!1),new a({color:255,opacity:.25})),[0,0,.5],[Math.PI/2,0,0]]]},this.highlightGizmos={Z:[],RX:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:16711680,opacity:1})),[0,0,0],[0,-Math.PI/2,-Math.PI/2],!1]],RY:[[new THREE.Mesh(new THREE.TorusGeometry(1,.02,12,60,2*Math.PI),new a({color:255,opacity:1})),[0,0,0],[Math.PI/2,0,0],!1]]},this.hemiPickerGizmos={XYZ:[[new THREE.Mesh(new THREE.SphereGeometry(1.2,8,8,0,Math.PI),new a({color:255})),null,null,!1]]}},this.setActivePlane=function(a,b){if("translate"==this.activeMode){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ))}else"rotate"==this.activeMode&&("RX"==a&&(this.activePlane=this.planes.YZ),"RY"==a&&(this.activePlane=this.planes.XZ),"RZ"==a&&(this.activePlane=this.planes.XY));this.hide(),this.show()},this.update=function(a,b){if("translate"==this.activeMode)THREE.TransformGizmo.prototype.update.apply(this,arguments);else if("rotate"==this.activeMode){THREE.TransformGizmo.prototype.update.apply(this,arguments);var c=new THREE.Matrix4,d=new THREE.Euler(0,0,1),e=new THREE.Quaternion,f=new THREE.Vector3(1,0,0),g=new THREE.Vector3(0,1,0),h=new THREE.Vector3(0,0,1),i=new THREE.Quaternion,j=new THREE.Quaternion,k=new THREE.Quaternion,l=b.clone();d.copy(this.planes.XY.rotation),e.setFromEuler(d),c.makeRotationFromQuaternion(e).getInverse(c),l.applyMatrix4(c),this.traverse(function(a){e.setFromEuler(d),"RX"==a.name&&(i.setFromAxisAngle(f,Math.atan2(-l.y,l.z)),e.multiplyQuaternions(e,i),a.quaternion.copy(e)),"RY"==a.name&&(j.setFromAxisAngle(g,Math.atan2(l.x,l.z)),e.multiplyQuaternions(e,j),a.quaternion.copy(e)),"RZ"==a.name&&(k.setFromAxisAngle(h,Math.atan2(l.y,l.x)),e.multiplyQuaternions(e,k),a.quaternion.copy(e))})}},this.show=function(){this.traverse(function(a){(null==b.parent||b.parent.useAllPickers||a.parent!=b.handles)&&(a.visible=!0),a.material&&(a.material.opacity=a.material.oldOpacity),a.parent!=b.pickers&&a.parent!=b.hemiPicker&&a.parent!=b.subPickers||(a.visible=!1),a.parent!=b.planes&&a.parent!=b.highlights||(a.visible=!1)}),this.activePlane.visible=!1},this.highlight=function(a){this.traverse(function(c){c.material&&c.material.highlight&&(c.name==a?(c.parent!=b.highlights&&c.parent!=b.handles||(c.visible=!0),c.material.highlight(!0)):(c.material.highlight(!1),c.material.opacity=.1))})},this.init()},THREE.TransformGizmoTranslateRotate.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformGizmoScale=function(){THREE.TransformGizmo.call(this),this.setHandlePickerGizmos=function(){var c=d(.125,.125,.125),f=e("X"),g=e("Y"),h=e("Z");this.handleGizmos={X:[[new THREE.Mesh(c,new a({color:16711680})),[.5,0,0],[0,0,-Math.PI/2]],[new THREE.Line(f,new b({color:16711680}))]],Y:[[new THREE.Mesh(c,new a({color:65280})),[0,.5,0]],[new THREE.Line(g,new b({color:65280}))]],Z:[[new THREE.Mesh(c,new a({color:255})),[0,0,.5],[Math.PI/2,0,0]],[new THREE.Line(h,new b({color:255}))]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.125,.125,.125),new a({color:16777215,opacity:.25}))]]},this.pickerGizmos={X:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:16711680,opacity:.25})),[.6,0,0],[0,0,-Math.PI/2]]],Y:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:65280,opacity:.25})),[0,.6,0]]],Z:[[new THREE.Mesh(new THREE.CylinderGeometry(.2,0,1,4,1,!1),new a({color:255,opacity:.25})),[0,0,.6],[Math.PI/2,0,0]]],XYZ:[[new THREE.Mesh(new THREE.BoxGeometry(.4,.4,.4),new a({color:16777215,opacity:.25}))]]}},this.setActivePlane=function(a,b){var c=new THREE.Matrix4;b.applyMatrix4(c.getInverse(c.extractRotation(this.planes.XY.matrixWorld))),"X"==a&&(this.activePlane=this.planes.XY,Math.abs(b.y)>Math.abs(b.z)&&(this.activePlane=this.planes.XZ)),"Y"==a&&(this.activePlane=this.planes.XY,Math.abs(b.x)>Math.abs(b.z)&&(this.activePlane=this.planes.YZ)),"Z"==a&&(this.activePlane=this.planes.XZ,Math.abs(b.x)>Math.abs(b.y)&&(this.activePlane=this.planes.YZ)),"XYZ"==a&&(this.activePlane=this.planes.XYZE),this.hide(),this.show()},this.init()},THREE.TransformGizmoScale.prototype=Object.create(THREE.TransformGizmo.prototype),THREE.TransformControls=function(a,b,c){function d(b,c){return THREE.TransformControls.intersectObjects(b.canvasX,b.canvasY,c,a,!0)}switch(THREE.Object3D.call(this),b=void 0!==b?b:document,this.gizmo={},c){case"translate":this.gizmo[c]=new THREE.TransformGizmoTranslate;break;case"rotate":this.gizmo[c]=new THREE.TransformGizmoRotate;break;case"transrotate":this.gizmo[c]=new THREE.TransformGizmoTranslateRotate;break;case"scale":this.gizmo[c]=new THREE.TransformGizmoScale}if(this.add(this.gizmo[c]),this.gizmo[c].hide(),this.object=void 0,this.snap=null,this.snapDelta=0,this.space="world",this.size=1,this.axis=null,this.useAllPickers=!0,this.unitX=new THREE.Vector3(1,0,0),this.unitY=new THREE.Vector3(0,1,0),this.unitZ=new THREE.Vector3(0,0,1),this.normal=new THREE.Vector3(0,0,1),"transrotate"===c){var e=new THREE.Geometry;e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1));var f=new THREE.LineBasicMaterial({color:0,linewidth:2,depthTest:!1});this.startLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineBasicMaterial({color:16770563,linewidth:2,depthTest:!1});e.vertices.push(new THREE.Vector3(0,0,0),new THREE.Vector3(0,0,1)),this.endLine=new THREE.Line(e,f);var e=new THREE.Geometry,f=new THREE.LineDashedMaterial({color:0,linewidth:1,depthTest:!1});e.vertices.push(new THREE.Vector3(0,-1,0),new THREE.Vector3(0,1,0)),this.centerLine=new THREE.Line(e,f);var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/centerMarker_X.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var e=new THREE.CircleGeometry(.1,32),f=new THREE.MeshBasicMaterial({opacity:1,side:THREE.DoubleSide,transparent:!0,map:g});this.centerMark=new THREE.Mesh(e,f),this.centerMark.rotation.set(Math.PI/2,0,0),this.ticks={};var g=THREE.ImageUtils.loadTexture(Autodesk.Viewing.Private.getResourceUrl("res/textures/cardinalPoint.png"));g.magFilter=g.minFilter=THREE.NearestFilter;var f=new THREE.MeshBasicMaterial({depthTest:!1,opacity:1,transparent:!0,side:THREE.DoubleSide,map:g}),h=.25;this.ticks.RX=new THREE.Object3D;var e=new THREE.PlaneBufferGeometry(.12,h),i=new THREE.Mesh(e,f);i.position.set(0,0,-1.275),i.rotation.set(Math.PI/2,Math.PI/2,0),this.ticks.RX.add(i),i=i.clone(),i.position.set(0,1.275,0),i.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(i),i=i.clone(),i.position.set(0,0,1.275),i.rotation.set(0,Math.PI/2,Math.PI/2),this.ticks.RX.add(i),i=i.clone(),i.position.set(0,-1.275,0),i.rotation.set(0,Math.PI/2,0),this.ticks.RX.add(i),this.ticks.RY=new THREE.Object3D,i=i.clone(),i.position.set(0,0,-1.275),i.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(i),i=i.clone(),i.position.set(-1.275,0,0),i.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(i),i=i.clone(),i.position.set(0,0,1.275),i.rotation.set(Math.PI/2,0,0),this.ticks.RY.add(i),i=i.clone(),i.position.set(1.275,0,0),i.rotation.set(Math.PI/2,0,Math.PI/2),this.ticks.RY.add(i)}var j=this,k=!1,l=c,m={type:"change"},n={type:"mouseDown"},o={type:"mouseUp",mode:l},p={type:"objectChange"},q=(new THREE.Raycaster,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3),r=new THREE.Vector3,s=new THREE.Vector3,t=new THREE.Vector3,u=1,v=new THREE.Matrix4,w=new THREE.Vector3,x=new THREE.Matrix4,y=new THREE.Vector3,z=new THREE.Quaternion,A=new THREE.Vector3,B=new THREE.Vector3,C=new THREE.Vector3,D=new THREE.Quaternion,E=new THREE.Quaternion,F=new THREE.Quaternion,G=new THREE.Quaternion,H=new THREE.Quaternion,I=new THREE.Vector3,J=new THREE.Vector3,K=new THREE.Matrix4,L=new THREE.Matrix4,M=new THREE.Vector3,N=new THREE.Vector3,O=new THREE.Euler,P=new THREE.Matrix4,Q=new THREE.Vector3;new THREE.Euler;this.attach=function(a){j.object=a,this.gizmo[l].show(),j.update(),j.updateUnitVectors()},this.detach=function(a){j.object=void 0,this.axis=null,this.gizmo[l].hide()},this.setMode=function(a){l=a||l,"scale"==l&&(j.space="local"),this.gizmo[l].show(),this.update(),j.dispatchEvent(m)},this.getPicker=function(){return j.gizmo[l].hemiPicker.children},this.setPosition=function(a){this.object.position.copy(a),this.update()},this.setNormal=function(a){z.setFromUnitVectors(this.normal,a),this.unitX.applyQuaternion(z),this.unitY.applyQuaternion(z),this.unitZ.applyQuaternion(z),this.normal.copy(a),this.object&&this.object.quaternion.multiply(z),this.update()},this.setSnap=function(a,b){j.snap=a,j.snapDelta=b},this.setSize=function(a){j.size=a,this.update(),j.dispatchEvent(m)},this.setSpace=function(a){j.space=a,this.update(),j.dispatchEvent(m)},this.update=function(c){if(void 0!==j.object){j.object.updateMatrixWorld(),N.setFromMatrixPosition(j.object.matrixWorld),O.setFromRotationMatrix(x.extractRotation(j.object.matrixWorld)),a.updateMatrixWorld(),Q.setFromMatrixPosition(a.matrixWorld),this.position.copy(N),this.quaternion.setFromEuler(O),this.normal.set(0,0,1),this.normal.applyEuler(O);var d;if(a.isPerspective){var e=N.distanceTo(Q);d=2*Math.tan(a.fov*Math.PI/360)*e}else d=a.top-a.bottom;var f=b.getBoundingClientRect();u=100*d/f.height,this.scale.set(u,u,u),c&&this.gizmo[l].highlight(j.axis)}},this.updateUnitVectors=function(){this.unitX.set(1,0,0),this.unitY.set(0,1,0),this.unitZ.set(0,0,1),this.unitX.applyEuler(O),this.unitY.applyEuler(O),this.unitZ.applyEuler(O)},this.showRotationGizmos=function(a){for(var b=this.gizmo[l].handles.children,c=0;c<b.length;c++){var d=b[c];d.visible=!0,-1!==d.name.search("R")&&(d.visible=a)}this.useAllPickers=a},this.highlight=function(){this.gizmo[l].highlight(this.axis||"Z")},this.onPointerHover=function(a){if(void 0===j.object||!0===k)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,j.useAllPickers?j.gizmo[l].pickers.children:j.gizmo[l].subPickers.children),e=null,f="";return c&&(e=c.object.name,f=-1!=e.search("R")?"rotate":"translate"),j.axis!==e&&(j.axis=e,j.gizmo[l].activeMode=f,j.update(!0),j.dispatchEvent(m)),null===j.axis&&j.gizmo[l].show(),!!c},this.onPointerDown=function(b){if(void 0===j.object||!0===k)return!1;var c=b.pointers?b.pointers[0]:b;if("touch"===b.pointerType){var e=d(c,j.useAllPickers?j.gizmo[l].pickers.children:j.gizmo[l].subPickers.children),f=null,g="";e&&(f=e.object.name,g=-1!=f.search("R")?"rotate":"translate"),j.axis!==f&&(j.axis=f,j.gizmo[l].activeMode=g)}var e=null;if((0===c.button||-1===c.button||void 0===c.button)&&(e=d(c,j.useAllPickers?j.gizmo[l].pickers.children:j.gizmo[l].subPickers.children))){j.dispatchEvent(n),j.axis=e.object.name,j.update(),w.copy(a.position).sub(N).normalize(),j.gizmo[l].setActivePlane(j.axis,w);var h=d(c,[j.gizmo[l].activePlane]);if(h&&r.copy(h.point),I.copy(j.object.position),J.copy(j.object.scale),K.extractRotation(j.object.matrix),P.extractRotation(j.object.matrixWorld),j.object.parent?(L.extractRotation(j.object.parent.matrixWorld),M.setFromMatrixScale(x.getInverse(j.object.parent.matrixWorld))):(L.extractRotation(j.object.matrixWorld),M.setFromMatrixScale(x.getInverse(j.object.matrixWorld))),"transrotate"===l&&"rotate"===j.gizmo[l].activeMode){j.startLine.geometry.vertices[0].set(0,0,0).applyMatrix4(j.matrixWorld),j.startLine.geometry.vertices[1].set(0,0,1).applyMatrix4(j.matrixWorld),j.startLine.geometry.verticesNeedUpdate=!0,j.parent.add(j.startLine);var i=j.object.geometry.getAttribute("position"),m=(new THREE.Vector3).fromAttribute(i,0).applyMatrix4(j.object.matrixWorld),o=(new THREE.Vector3).fromAttribute(i,1).applyMatrix4(j.object.matrixWorld),p=(new THREE.Vector3).fromAttribute(i,2).applyMatrix4(j.object.matrixWorld),q=(new THREE.Vector3).fromAttribute(i,3).applyMatrix4(j.object.matrixWorld);if("RX"===j.axis){m.lerp(p,.5),o.lerp(q,.5);var s=m.distanceTo(o);j.centerLine.material.dashSize=s/15,j.centerLine.material.gapSize=s/30,j.centerLine.geometry.vertices[0].copy(m),j.centerLine.geometry.vertices[1].copy(o)}else{m.lerp(o,.5),p.lerp(q,.5);var s=m.distanceTo(p);j.centerLine.material.dashSize=s/15,j.centerLine.material.gapSize=s/30,j.centerLine.geometry.vertices[0].copy(m),j.centerLine.geometry.vertices[1].copy(p)}j.centerLine.geometry.computeLineDistances(),j.centerLine.geometry.verticesNeedUpdate=!0,j.parent.add(j.centerLine),j.ticks[j.axis].position.copy(j.position),j.ticks[j.axis].quaternion.copy(j.quaternion),j.ticks[j.axis].scale.copy(j.scale),j.parent.add(j.ticks[j.axis])}}return k=!0,!!e},this.onPointerMove=function(a){if(void 0===j.object||null===j.axis||!1===k)return!1;var b=a.pointers?a.pointers[0]:a,c=d(b,[j.gizmo[l].activePlane]);c&&q.copy(c.point);var e=j.gizmo[l].activeMode;if("translate"==e)q.sub(r),q.multiply(M),"local"==j.space&&(q.applyMatrix4(x.getInverse(P)),A.copy(this.unitX),B.copy(this.unitY),C.copy(this.unitZ),y.set(0,0,0),-1!=j.axis.search("X")&&(A.multiplyScalar(q.dot(this.unitX)),y.add(A)),-1!=j.axis.search("Y")&&(B.multiplyScalar(q.dot(this.unitY)),y.add(B)),-1!=j.axis.search("Z")&&(C.multiplyScalar(q.dot(this.unitZ)),y.add(C)),q.copy(y),q.applyMatrix4(K),j.object.position.copy(I),j.object.position.add(q)),"world"!=j.space&&-1==j.axis.search("XYZ")||(A.copy(this.unitX),B.copy(this.unitY),C.copy(this.unitZ),y.set(0,0,0),-1!=j.axis.search("X")&&(A.multiplyScalar(q.dot(this.unitX)),y.add(A)),-1!=j.axis.search("Y")&&(B.multiplyScalar(q.dot(this.unitY)),y.add(B)),-1!=j.axis.search("Z")&&(C.multiplyScalar(q.dot(this.unitZ)),y.add(C)),q.copy(y),q.applyMatrix4(x.getInverse(L)),j.object.position.copy(I),j.object.position.add(q));else if("scale"==e)q.sub(r),q.multiply(M),"local"==j.space&&("XYZ"==j.axis?(u=1+q.y/50,j.object.scale.x=J.x*u,j.object.scale.y=J.y*u,j.object.scale.z=J.z*u):(q.applyMatrix4(x.getInverse(P)),"X"==j.axis&&(j.object.scale.x=J.x*(1+q.x/50)),"Y"==j.axis&&(j.object.scale.y=J.y*(1+q.y/50)),"Z"==j.axis&&(j.object.scale.z=J.z*(1+q.z/50))));else if("rotate"==e){if(q.sub(N),q.multiply(M),y.copy(r).sub(N),y.multiply(M),"RE"==j.axis){q.applyMatrix4(x.getInverse(v)),y.applyMatrix4(x.getInverse(v)),s.set(Math.atan2(q.z,q.y),Math.atan2(q.x,q.z),Math.atan2(q.y,q.x)),t.set(Math.atan2(y.z,y.y),Math.atan2(y.x,y.z),Math.atan2(y.y,y.x)),z.setFromRotationMatrix(x.getInverse(L));var f=s.z-t.z;if(null!==j.snap){var g=Math.round(f/j.snap)*j.snap;Math.abs(g-f)<j.snapDelta&&(f=g)}H.setFromAxisAngle(w,f),D.setFromRotationMatrix(P),z.multiplyQuaternions(z,H),z.multiplyQuaternions(z,D),j.object.quaternion.copy(z)}else if("RXYZE"==j.axis){var h=q.clone().cross(y).normalize();z.setFromRotationMatrix(x.getInverse(L));var i=-q.clone().angleTo(y);if(null!==j.snap){var g=Math.round(i/j.snap)*j.snap;Math.abs(g-i)<j.snapDelta&&(i=g)}E.setFromAxisAngle(h,i),D.setFromRotationMatrix(P),z.multiplyQuaternions(z,E),z.multiplyQuaternions(z,D),j.object.quaternion.copy(z)}else if("local"==j.space){q.applyMatrix4(x.getInverse(P)),y.applyMatrix4(x.getInverse(P));var n=q.dot(this.unitX),o=q.dot(this.unitY),O=q.dot(this.unitZ),Q=y.dot(this.unitX),R=y.dot(this.unitY),S=y.dot(this.unitZ);s.set(Math.atan2(O,o),Math.atan2(n,O),Math.atan2(o,n)),t.set(Math.atan2(S,R),Math.atan2(Q,S),Math.atan2(R,Q));var T=s.x-t.x,U=s.y-t.y,f=s.z-t.z;if(null!==j.snap){if(-1!=j.axis.search("X")){var g=Math.round(T/j.snap)*j.snap;Math.abs(g-T)<j.snapDelta&&(T=g)}if(-1!=j.axis.search("Y")){var g=Math.round(U/j.snap)*j.snap;Math.abs(g-U)<j.snapDelta&&(U=g)}if(-1!=j.axis.search("Z")){var g=Math.round(f/j.snap)*j.snap;Math.abs(g-f)<j.snapDelta&&(f=g)}}E.setFromAxisAngle(this.unitX,T),F.setFromAxisAngle(this.unitY,U),G.setFromAxisAngle(this.unitZ,f),D.setFromRotationMatrix(K),"RX"==j.axis&&D.multiplyQuaternions(D,E),"RY"==j.axis&&D.multiplyQuaternions(D,F),"RZ"==j.axis&&D.multiplyQuaternions(D,G),j.object.quaternion.copy(D)}else if("world"==j.space){var n=q.dot(this.unitX),o=q.dot(this.unitY),O=q.dot(this.unitZ),Q=y.dot(this.unitX),R=y.dot(this.unitY),S=y.dot(this.unitZ);s.set(Math.atan2(O,o),Math.atan2(n,O),Math.atan2(o,n)),t.set(Math.atan2(S,R),Math.atan2(Q,S),Math.atan2(R,Q)),z.setFromRotationMatrix(x.getInverse(L));var T=s.x-t.x,U=s.y-t.y,f=s.z-t.z;if(null!==j.snap){if(-1!=j.axis.search("X")){var g=Math.round(T/j.snap)*j.snap;Math.abs(g-T)<j.snapDelta&&(T=g)}if(-1!=j.axis.search("Y")){var g=Math.round(U/j.snap)*j.snap;Math.abs(g-U)<j.snapDelta&&(U=g)}if(-1!=j.axis.search("Z")){var g=Math.round(f/j.snap)*j.snap;Math.abs(g-f)<j.snapDelta&&(f=g)}}E.setFromAxisAngle(this.unitX,T),F.setFromAxisAngle(this.unitY,U),G.setFromAxisAngle(this.unitZ,f),D.setFromRotationMatrix(P),"RX"==j.axis&&z.multiplyQuaternions(z,E),"RY"==j.axis&&z.multiplyQuaternions(z,F),"RZ"==j.axis&&z.multiplyQuaternions(z,G),z.multiplyQuaternions(z,D),j.object.quaternion.copy(z)}"transrotate"===l&&(j.add(j.endLine),j.add(j.centerMark))}return j.object.matrixAutoUpdate=!0,j.update(!0),j.dispatchEvent(m),j.dispatchEvent(p),!!c},this.onPointerUp=function(a){return k&&null!==j.axis&&(o.mode=l,j.dispatchEvent(o)),k=!1,this.gizmo[l].show(),this.updateUnitVectors(),"transrotate"===l&&"rotate"===this.gizmo[l].activeMode&&(this.remove(this.endLine),this.remove(this.centerMark),this.parent.remove(this.centerLine),this.parent.remove(this.startLine),this.parent.remove(this.ticks[this.axis])),!1}},THREE.TransformControls.intersectObjects=function(){var a=new THREE.Vector3,b=new THREE.Vector3,c=new THREE.Raycaster;return function(d,e,f,g,h){var i=d/g.clientWidth*2-1,j=-e/g.clientHeight*2+1;g.isPerspective?(a.set(i,j,.5),a.unproject(g),c.set(g.position,a.sub(g.position).normalize())):(a.set(i,j,-1),a.unproject(g),b.set(0,0,-1),c.set(a,b.transformDirection(g.matrixWorld)));var k=c.intersectObjects(f,h);return k[0]?k[0]:null}}(),THREE.TransformControls.prototype=Object.create(THREE.Object3D.prototype)}function init_three_triangulator(){
"use strict";Autodesk.Viewing.Private.Triangulator||(Autodesk.Viewing.Private.Triangulator=function(){function a(a,b,c){return c+":"+(a<b?a+":"+b:b+":"+a)}function b(b,c,d,e,f,g,h){this.pt1=b,this.pt2=c,this.p1=-1,this.p2=-1,this.eid1=a(d,e,h),this.eid2=a(f,g,h)}function c(){this.bbox=new THREE.Box2,this.left=null,this.right=null,this.node_edges=[]}function d(a,b,c){this.pts=a,this.edges=b,this.bbox=c,this.pipResult=!1}function e(a,b){this.edges=a,this.bbox=b,this.pts=[],this.idmap={},this.xymap={},this.contours=[],this.scale=1e6/this.bbox.size().length()}function f(a){this.indices=[],this.cset=a;var b=this.pts=a.pts;this.intervalTree=new d(a.pts,a.edges,a.bbox),this.intervalTree.build();for(var c=0;c<b.length;c++)b[c].id=c;var e=new lmv_poly2tri.SweepContext([]);if(e.points_=b.slice(),a.contours)for(var f=this.cset.contours,g=0;g<f.length;g++){for(var h=f[g],i=h[0]!==h[h.length-1],j=[],k=0;k<h.length-1;k++)j.push(b[h[k]]);e.initEdges(j,i)}else for(var l=this.cset.edges,c=0;c<l.length;c++){var m=l[c];if(m.p1!=m.p2){var n=[b[m.p1],b[m.p2]];e.initEdges(n,!0)}}this.triangulate(e),this.processResult(e)}var g=Autodesk.Viewing.Private;return d.prototype.splitNode=function(a){if(!(a.bbox.min.y>=a.bbox.max.y||a.node_edges.length<3)){var b=.5*(a.bbox.min.y+a.bbox.max.y);a.left=new c,a.right=new c;for(var d=this.pts,e=a.node_edges,f=[],g=new THREE.Vector2,h=0;h<e.length;h++){var i=this.edges[e[h]],j=d[i.p1].y,k=d[i.p2].y;if(j>k){var l=j;j=k,k=l}var m=null;k<b?(a.left.node_edges.push(e[h]),m=a.left.bbox):j>b?(a.right.node_edges.push(e[h]),m=a.right.bbox):f.push(e[h]),m&&(g.set(d[i.p1].x,d[i.p1].y),m.expandByPoint(g),g.set(d[i.p2].x,d[i.p2].y),m.expandByPoint(g))}a.node_edges=f,a.left.node_edges.length&&this.splitNode(a.left),a.right.node_edges.length&&this.splitNode(a.right)}},d.prototype.build=function(){this.root=new c;for(var a=this.root.node_edges,b=0;b<this.edges.length;b++)a.push(b);this.root.bbox.copy(this.bbox),this.splitNode(this.root)},d.prototype.pointInPolygonRec=function(a,b,c){if(a.bbox.min.y<=c&&a.bbox.max.y>=c)for(var d=this.pts,e=a.node_edges,f=0,g=e.length;f<g;f++){var h=this.edges[e[f]],i=d[h.p1],j=i.x,k=i.y,l=k>=c,m=d[h.p2],n=m.x,o=m.y,p=o>=c;l!=p&&(o-c)*(j-n)>=(n-b)*(k-o)==p&&(this.pipResult=!this.pipResult)}var q=a.left;q&&q.bbox.min.y<=c&&q.bbox.max.y>=c&&this.pointInPolygonRec(q,b,c);var r=a.right;r&&r.bbox.min.y<=c&&r.bbox.max.y>=c&&this.pointInPolygonRec(r,b,c)},d.prototype.pointInPolygon=function(a,b){return this.pipResult=!1,this.pointInPolygonRec(this.root,a,b),this.pipResult},e.prototype.getPointIndex=function(a,b,c){var d=this.idmap[c];if(void 0!==d)return d;var e,f=0|a*this.scale,g=0|b*this.scale,h=this.xymap[f];return void 0===h?(this.xymap[f]=h={},e=void 0):e=h[g],void 0===e&&(h[g]=e=this.pts.length,this.idmap[c]=e,this.pts.push({x:a,y:b})),e},e.prototype.snapEdges=function(){for(var a=0;a<this.edges.length;a++){var b=this.edges[a];b.p1=this.getPointIndex(b.pt1.x,b.pt1.y,b.eid1),b.p2=this.getPointIndex(b.pt2.x,b.pt2.y,b.eid2)}},e.prototype.sanitizeEdges=function(){for(var a={},b=[],c=0,d=this.edges.length;c<d;c++){var e=this.edges[c];if(e.p1!==e.p2){var f=Math.min(e.p1,e.p2)+":"+Math.max(e.p1,e.p2);!0!==a[f]&&(a[f]=!0,b.push(e))}}this.edges=b},e.prototype.stitchContours=function(){for(var a={},b=0;b<this.edges.length;b++){var c=this.edges[b];c.p1!==c.p2&&(void 0!==a[c.p1]?a[c.p1].push(c.p2):a[c.p1]=[c.p2],void 0!==a[c.p2]?a[c.p2].push(c.p1):a[c.p2]=[c.p1])}var d=[];for(var e in a)if(2!==a[e].length){g.logger.warn("Incomplete edge table");break}for(;;){var f=void 0;for(var e in a)if(a[e].length>1){f=e;break}if(!f)for(var e in a)if(a[e].length>0){f=e;break}if(!f)break;var h=-1,i=parseInt(f),j=a[f];for(d.push(i);j&&j.length;){var k=j.shift();if(k===h&&(k=j.shift()),void 0===k){delete a[i];break}d.push(k),0==j.length?delete a[i]:j[0]===h&&delete a[i],h=i,i=k,j=a[k]}d.length&&(this.contours.push(d),d=[])}for(var l=[],b=0;b<this.contours.length;b++){var m=this.contours[b];m[0]!==m[m.length-1]&&l.push(m)}if(l.length)for(var n=!0;n;){n=!1;for(var o={},p=this.contours,b=0;b<p.length;b++){var m=p[b],q=m[0],r=m[m.length-1];q!==r&&(o[q]?o[q].push(-b-1):o[q]=[-b-1],o[r]?o[r].push(b):o[r]=[b])}for(var e in o){var s=o[e];if(2==s.length){var t=void 0;if(s[0]<0&&s[1]<0){var u=-s[0]-1,v=-s[1]-1;p[v].shift(),Array.prototype.push.apply(p[u].reverse(),p[v]),t=v}if(s[0]<0&&s[1]>0){var u=-s[0]-1,v=s[1];p[v].pop(),Array.prototype.push.apply(p[v],p[u]),t=u}if(s[0]>0&&s[1]<0){var u=s[0],v=-s[1]-1;p[u].pop(),Array.prototype.push.apply(p[u],p[v]),t=v}if(s[0]>0&&s[1]>0){var u=s[0],v=s[1];p[u].pop(),Array.prototype.push.apply(p[u],p[v].reverse()),t=v}void 0!==t&&(p.splice(t,1),n=!0);break}}}},f.prototype.triangulate=function(a){try{a.triangulate()}catch(a){}},f.prototype.processResult=function(a){for(var b=0;b<a.map_.length;b++){var c=a.map_[b],d=c.points_[0],e=c.points_[1],f=c.points_[2];void 0!==d.id&&void 0!==e.id&&void 0!==f.id&&this.filterFace(d.id,e.id,f.id)}},f.prototype.pointInEdgeList=function(a,b){for(var c,d,e,f,g,h,i=this.cset.pts,j=this.cset.edges,k=!1,l=0,m=j.length;l<m;++l){var n=j[l];e=i[n.p1].x,f=i[n.p1].y,c=f>=b,g=i[n.p2].x,h=i[n.p2].y,d=h>=b,c!=d&&(h-b)*(e-g)>=(g-a)*(f-h)==d&&(k=!k)}return k},f.prototype.pointInContour=function(a,b,c){var d,e,f,g,h,i,j=!1,k=this.cset.pts;f=k[c[c.length-1]].x,g=k[c[c.length-1]].y,d=g>=b;for(var l=0,m=c.length;l<m;++l)h=k[c[l]].x,i=k[c[l]].y,e=i>=b,d!=e&&(i-b)*(f-h)>=(h-a)*(g-i)==e&&(j=!j),d=e,f=h,g=i;return j},f.prototype.pointInPolygon=function(a,b){for(var c=!1,d=0;d<this.cset.contours.length;d++)this.pointInContour(a,b,this.cset.contours[d])&&(c=!c);return c},f.prototype.filterFace=function(a,b,c){var d=this.pts[a],e=this.pts[b],f=this.pts[c],g=(d.x+e.x+f.x)/3,h=(d.y+e.y+f.y)/3;if(this.intervalTree.pointInPolygon(g,h)){var i=e.x-d.x,j=e.y-d.y,k=f.x-d.x;i*(f.y-d.y)-k*j>0?this.indices.push(a,b,c):this.indices.push(a,c,b)}},{TriangulatedSurface:f,ContourSet:e,Edge:b}}())}function init_three_intersector(){"use strict";Autodesk.Viewing.Private.Intersector||(Autodesk.Viewing.Private.Intersector=function(){function a(a){return Math.abs(a)<j}function b(b,c,d,e,f){var g=l.subVectors(d,c),h=b.normal.dot(g);if(a(h))return e.copy(c),f.copy(d),2;h=1/h;var i=-(c.dot(b.normal)*h+b.constant*h);if(i<-j||i>1+j)return 0;var k=g.multiplyScalar(i).add(c);return e.copy(k),1}function c(a,c,d,e,f,g,h,l,o){var p=a.distanceToPoint(c),q=a.distanceToPoint(d),r=a.distanceToPoint(e);if(p<-j&&q<-j&&r<-j)return null;if(p>j&&q>j&&r>j)return null;var s=Math.sign(p),t=Math.sign(q),u=Math.sign(r);if(0===s&&0===t&&0===u)return null;var v,w,x,y,z,A;if(s!==t){var B=b(a,c,d,m,n);if(2==B)return void l.push(new k(c.clone(),d.clone(),f,f,g,g,o));1==B?(x=f,y=g,v=m.clone()):i.logger.warn("Unexpected zero intersections where at least one was expected")}if(t!==u){var B=b(a,d,e,m,n);if(2==B)return void l.push(new k(d.clone(),e.clone(),g,g,h,h,o));1==B?v?m.distanceTo(v)>j&&(z=g,A=h,w=m.clone()):(x=g,y=h,v=m.clone()):i.logger.warn("Unexpected zero intersections where at least one was expected")}if(u!==s){var B=b(a,e,c,m,n);if(2==B)return void l.push(new k(e.clone(),c.clone(),h,h,f,f,o));1==B?v?m.distanceTo(v)>j&&(z=h,A=f,w=m.clone()):i.logger.warn("Unexpected single intersection point"):i.logger.warn("Unexpected zero intersections where at least one was expected")}v&&w?l.push(new k(v,w,x,y,z,A,o)):i.logger.warn("Unexpected one intersection where two were expected")}function d(a,b){o.set(b.min.x,b.min.y,b.min.z);var c=a.distanceToPoint(o),d=Math.sign(c);o.set(b.min.x,b.min.y,b.max.z);var e=a.distanceToPoint(o);return Math.sign(e)!==d||(o.set(b.min.x,b.max.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.min.x,b.max.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.min.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.min.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.max.y,b.min.z),e=a.distanceToPoint(o),Math.sign(e)!==d||(o.set(b.max.x,b.max.y,b.max.z),e=a.distanceToPoint(o),Math.sign(e)!==d))))))}function e(a,b,d){var e=b.geometry,f=d.length,g=b.matrixWorld;p.getInverse(g),q.copy(a).applyMatrix4(p),i.VertexEnumerator.enumMeshTriangles(e,function(a,e,f,g,h,i){c(q,a,e,f,g,h,i,d,b.fragId)});for(var h=f;h<d.length;h++)d[h].pt1.applyMatrix4(g),d[h].pt2.applyMatrix4(g)}function f(a,b,c){var d=b,e=Math.sqrt(1-d*d),f=1-d,g=a.x,h=a.y,i=a.z,j=f*g,k=f*h;c.set(j*g+d,j*h-e*i,j*i+e*h,0,j*h+e*i,k*h+d,k*i-e*g,0,j*i-e*h,k*i+e*g,f*i*i+d,0,0,0,0,1)}function g(b){var c=new THREE.Vector3(0,0,1),d=b.normal.clone().cross(c);d=d.normalize();var e=c.dot(b.normal),g=new THREE.Matrix4;return a(d.x)&&a(d.y)&&a(d.z)?g.elements[14]=e*b.constant:(f(d,e,g),g.elements[14]=b.constant),g}function h(a,b,c){for(var d=0;d<b.length;d++){var e=b[d];e.pt1.applyMatrix4(a),e.pt2.applyMatrix4(a),c.expandByPoint(e.pt1),c.expandByPoint(e.pt2)}}var i=Autodesk.Viewing.Private,j=1e-10,k=Autodesk.Viewing.Private.Triangulator.Edge,l=new THREE.Vector3,m=new THREE.Vector3,n=new THREE.Vector3,o=new THREE.Vector3,p=new THREE.Matrix4,q=new THREE.Plane;return{makePlaneBasis:g,convertToPlaneCoords:h,intersectTrianglePlane:c,intersectMeshPlane:e,intersectBoxPlane:d}}())}function init_SectionMesh(){Autodesk.Viewing.Extensions.Section.SectionMesh||(Autodesk.Viewing.Extensions.Section.SectionMesh=function(a,b,c){THREE.Mesh.call(this,a,b,!1),this.plane=c,this.planeVec=new THREE.Vector4(c.normal.x,c.normal.y,c.normal.z,c.constant),this.connectivity=[],this.outlines=[]},Autodesk.Viewing.Extensions.Section.SectionMesh.prototype=Object.create(THREE.Mesh.prototype),Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.constructor=Autodesk.Viewing.Extensions.Section.SectionMesh,Autodesk.Viewing.Extensions.Section.SectionMesh.prototype.update=function(){this.plane.normal.set(0,0,1),this.plane.normal.applyQuaternion(this.quaternion);var a=this.plane.normal,b=-1*this.getWorldPosition().dot(a);this.planeVec.set(a.x,a.y,a.z,b),this.plane.constant=b})}!function(a){var b;"undefined"!=typeof window?b=window:"undefined"!=typeof global?b=global:"undefined"!=typeof self&&(b=self),b.lmv_poly2tri=function(){return function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c||a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){b.exports={version:"1.3.5"}},{}],2:[function(a,b,c){"use strict";var d=function(a,b){this.point=a,this.triangle=b||null,this.next=null,this.prev=null,this.value=a.x},e=function(a,b){this.head_=a,this.tail_=b,this.search_node_=a};e.prototype.head=function(){return this.head_},e.prototype.setHead=function(a){this.head_=a},e.prototype.tail=function(){return this.tail_},e.prototype.setTail=function(a){this.tail_=a},e.prototype.search=function(){return this.search_node_},e.prototype.setSearch=function(a){this.search_node_=a},e.prototype.findSearchNode=function(){return this.search_node_},e.prototype.locateNode=function(a){var b=this.search_node_;if(a<b.value){for(;b=b.prev;)if(a>=b.value)return this.search_node_=b,b}else for(;b=b.next;)if(a<b.value)return this.search_node_=b.prev,b.prev;return null},e.prototype.locatePoint=function(a){var b=a.x,c=this.findSearchNode(b),d=c.point.x;if(b===d){if(a!==c.point)if(a===c.prev.point)c=c.prev;else{if(a!==c.next.point)throw new Error("poly2tri Invalid AdvancingFront.locatePoint() call");c=c.next}}else if(b<d)for(;(c=c.prev)&&a!==c.point;);else for(;(c=c.next)&&a!==c.point;);return c&&(this.search_node_=c),c},b.exports=e,b.exports.Node=d},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!a)throw new Error(b||"Assert Failed")}b.exports=d},{}],4:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.x=+a||0,this.y=+b||0,this._p2t_edge_list=null};e.prototype.toString=function(){return d.toStringBase(this)},e.prototype.toJSON=function(){return{x:this.x,y:this.y}},e.prototype.clone=function(){return new e(this.x,this.y)},e.prototype.set_zero=function(){return this.x=0,this.y=0,this},e.prototype.set=function(a,b){return this.x=+a||0,this.y=+b||0,this},e.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},e.prototype.add=function(a){return this.x+=a.x,this.y+=a.y,this},e.prototype.sub=function(a){return this.x-=a.x,this.y-=a.y,this},e.prototype.mul=function(a){return this.x*=a,this.y*=a,this},e.prototype.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},e.prototype.normalize=function(){var a=this.length();return this.x/=a,this.y/=a,a},e.prototype.equals=function(a){return this.x===a.x&&this.y===a.y},e.negate=function(a){return new e(-a.x,-a.y)},e.add=function(a,b){return new e(a.x+b.x,a.y+b.y)},e.sub=function(a,b){return new e(a.x-b.x,a.y-b.y)},e.mul=function(a,b){return new e(a*b.x,a*b.y)},e.cross=function(a,b){return"number"==typeof a?"number"==typeof b?a*b:new e(-a*b.y,a*b.x):"number"==typeof b?new e(b*a.y,-b*a.x):a.x*b.y-a.y*b.x},e.toString=d.toString,e.compare=d.compare,e.cmp=d.compare,e.equals=d.equals,e.dot=function(a,b){return a.x*b.x+a.y*b.y},b.exports=e},{"./xy":11}],5:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b){this.name="PointError",this.points=b=b||[],this.message=a||"Invalid Points!";for(var c=0;c<b.length;c++)this.message+=" "+d.toString(b[c])};e.prototype=new Error,e.prototype.constructor=e,b.exports=e},{"./xy":11}],6:[function(a,b,c){(function(b){"use strict";var d=b.poly2tri;c.noConflict=function(){return b.poly2tri=d,c},c.VERSION=a("../dist/version.json").version,c.PointError=a("./pointerror"),c.Point=a("./point"),c.Triangle=a("./triangle"),c.SweepContext=a("./sweepcontext");var e=a("./sweep");c.triangulate=e.triangulate,c.sweep={Triangulate:e.triangulate}}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"../dist/version.json":1,"./point":4,"./pointerror":5,"./sweep":7,"./sweepcontext":8,"./triangle":9}],7:[function(a,b,c){"use strict";function d(a){a.initTriangulation(),a.createAdvancingFront(),e(a),f(a)}function e(a){var b,c=a.pointCount();for(b=1;b<c;++b)for(var d=a.getPoint(b),e=g(a,d),f=d._p2t_edge_list,i=0;f&&i<f.length;++i)h(a,f[i],e)}function f(a){for(var b=a.front().head().next.triangle,c=a.front().head().next.point;!b.getConstrainedEdgeCW(c);)b=b.neighborCCW(c);a.meshClean(b)}function g(a,b){var c=a.locateNode(b),d=k(a,b,c);return b.x<=c.point.x+M&&l(a,c),m(a,d),d}function h(a,b,c){a.edge_event.constrained_edge=b,a.edge_event.right=b.p.x>b.q.x,j(c.triangle,b.p,b.q)||(u(a,b,c),i(a,b.p,b.q,c.triangle,b.q))}function i(a,b,c,d,e){if(!j(d,b,c)){var f=d.pointCCW(e),g=O(c,f,b);if(g===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,f,b]);var h=d.pointCW(e),k=O(c,h,b);if(k===N.COLLINEAR)throw new I("poly2tri EdgeEvent: Collinear not supported!",[c,h,b]);g===k?(d=g===N.CW?d.neighborCCW(e):d.neighborCW(e),i(a,b,c,d,e)):D(a,b,c,d,e)}}function j(a,b,c){var d=a.edgeIndex(b,c);if(-1!==d){a.markConstrainedEdgeByIndex(d);var e=a.getNeighbor(d);return e&&e.markConstrainedEdgeByPoints(b,c),!0}return!1}function k(a,b,c){var d=new J(b,c.point,c.next.point);d.markNeighbor(c.triangle),a.addToMap(d);var e=new K(b);return e.next=c.next,e.prev=c,c.next.prev=e,c.next=e,o(a,d)||a.mapTriangleToNodes(d),e}function l(a,b){var c=new J(b.prev.point,b.point,b.next.point);c.markNeighbor(b.prev.triangle),c.markNeighbor(b.triangle),a.addToMap(c),b.prev.next=b.next,b.next.prev=b.prev,o(a,c)||a.mapTriangleToNodes(c)}function m(a,b){for(var c=b.next;c.next&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.next;for(c=b.prev;c.prev&&!Q(c.point,c.next.point,c.prev.point);)l(a,c),c=c.prev;b.next&&b.next.next&&n(b)&&r(a,b)}function n(a){var b=a.point.x-a.next.next.point.x,c=a.point.y-a.next.next.point.y;return H(c>=0,"unordered y"),b>=0||Math.abs(b)<c}function o(a,b){for(var c=0;c<3;++c)if(!b.delaunay_edge[c]){var d=b.getNeighbor(c);if(d){var e=b.getPoint(c),f=d.oppositePoint(b,e),g=d.index(f);if(d.constrained_edge[g]||d.delaunay_edge[g]){b.constrained_edge[c]=d.constrained_edge[g];continue}var h=p(e,b.pointCCW(e),b.pointCW(e),f);if(h){b.delaunay_edge[c]=!0,d.delaunay_edge[g]=!0,q(b,e,d,f);var i=!o(a,b);return i&&a.mapTriangleToNodes(b),i=!o(a,d),i&&a.mapTriangleToNodes(d),b.delaunay_edge[c]=!1,d.delaunay_edge[g]=!1,!0}}}return!1}function p(a,b,c,d){var e=a.x-d.x,f=a.y-d.y,g=b.x-d.x,h=b.y-d.y,i=e*h,j=g*f,k=i-j;if(k<=0)return!1;var l=c.x-d.x,m=c.y-d.y,n=l*f,o=e*m,p=n-o;return!(p<=0)&&(e*e+f*f)*(g*m-l*h)+(g*g+h*h)*p+(l*l+m*m)*k>0}function q(a,b,c,d){var e,f,g,h;e=a.neighborCCW(b),f=a.neighborCW(b),g=c.neighborCCW(d),h=c.neighborCW(d);var i,j,k,l;i=a.getConstrainedEdgeCCW(b),j=a.getConstrainedEdgeCW(b),k=c.getConstrainedEdgeCCW(d),l=c.getConstrainedEdgeCW(d);var m,n,o,p;m=a.getDelaunayEdgeCCW(b),n=a.getDelaunayEdgeCW(b),o=c.getDelaunayEdgeCCW(d),p=c.getDelaunayEdgeCW(d),a.legalize(b,d),c.legalize(d,b),c.setDelaunayEdgeCCW(b,m),a.setDelaunayEdgeCW(b,n),a.setDelaunayEdgeCCW(d,o),c.setDelaunayEdgeCW(d,p),c.setConstrainedEdgeCCW(b,i),a.setConstrainedEdgeCW(b,j),a.setConstrainedEdgeCCW(d,k),c.setConstrainedEdgeCW(d,l),a.clearNeighbors(),c.clearNeighbors(),e&&c.markNeighbor(e),f&&a.markNeighbor(f),g&&a.markNeighbor(g),h&&c.markNeighbor(h),a.markNeighbor(c)}function r(a,b){for(O(b.point,b.next.point,b.next.next.point)===N.CCW?a.basin.left_node=b.next.next:a.basin.left_node=b.next,a.basin.bottom_node=a.basin.left_node;a.basin.bottom_node.next&&a.basin.bottom_node.point.y>=a.basin.bottom_node.next.point.y;)a.basin.bottom_node=a.basin.bottom_node.next;if(a.basin.bottom_node!==a.basin.left_node){for(a.basin.right_node=a.basin.bottom_node;a.basin.right_node.next&&a.basin.right_node.point.y<a.basin.right_node.next.point.y;)a.basin.right_node=a.basin.right_node.next;a.basin.right_node!==a.basin.bottom_node&&(a.basin.width=a.basin.right_node.point.x-a.basin.left_node.point.x,a.basin.left_highest=a.basin.left_node.point.y>a.basin.right_node.point.y,s(a,a.basin.bottom_node))}}function s(a,b){if(!t(a,b)){l(a,b);if(b.prev!==a.basin.left_node||b.next!==a.basin.right_node){if(b.prev===a.basin.left_node){if(O(b.point,b.next.point,b.next.next.point)===N.CW)return;b=b.next}else if(b.next===a.basin.right_node){if(O(b.point,b.prev.point,b.prev.prev.point)===N.CCW)return;b=b.prev}else b=b.prev.point.y<b.next.point.y?b.prev:b.next;s(a,b)}}}function t(a,b){var c;return c=a.basin.left_highest?a.basin.left_node.point.y-b.point.y:a.basin.right_node.point.y-b.point.y,a.basin.width>c}function u(a,b,c){a.edge_event.right?v(a,b,c):z(a,b,c)}function v(a,b,c){for(;c.next.point.x<b.p.x;)O(b.q,c.next.point,b.p)===N.CCW?w(a,b,c):c=c.next}function w(a,b,c){c.point.x<b.p.x&&(O(c.point,c.next.point,c.next.next.point)===N.CCW?x(a,b,c):(y(a,b,c),w(a,b,c)))}function x(a,b,c){l(a,c.next),c.next.point!==b.p&&O(b.q,c.next.point,b.p)===N.CCW&&O(c.point,c.next.point,c.next.next.point)===N.CCW&&x(a,b,c)}function y(a,b,c){O(c.next.point,c.next.next.point,c.next.next.next.point)===N.CCW?x(a,b,c.next):O(b.q,c.next.next.point,b.p)===N.CCW&&y(a,b,c.next)}function z(a,b,c){for(;c.prev.point.x>b.p.x;)O(b.q,c.prev.point,b.p)===N.CW?A(a,b,c):c=c.prev}function A(a,b,c){c.point.x>b.p.x&&(O(c.point,c.prev.point,c.prev.prev.point)===N.CW?C(a,b,c):(B(a,b,c),A(a,b,c)))}function B(a,b,c){O(c.prev.point,c.prev.prev.point,c.prev.prev.prev.point)===N.CW?C(a,b,c.prev):O(b.q,c.prev.prev.point,b.p)===N.CW&&B(a,b,c.prev)}function C(a,b,c){l(a,c.prev),c.prev.point!==b.p&&O(b.q,c.prev.point,b.p)===N.CW&&O(c.point,c.prev.point,c.prev.prev.point)===N.CW&&C(a,b,c)}function D(a,b,c,d,e){var f=d.neighborAcross(e);H(f,"FLIP failed due to missing triangle!");var g=f.oppositePoint(d,e);if(d.getConstrainedEdgeAcross(e)){var h=d.index(e);throw new I("poly2tri Intersecting Constraints",[e,g,d.getPoint((h+1)%3),d.getPoint((h+2)%3)])}if(P(e,d.pointCCW(e),d.pointCW(e),g))if(q(d,e,f,g),a.mapTriangleToNodes(d),a.mapTriangleToNodes(f),e===c&&g===b)c===a.edge_event.constrained_edge.q&&b===a.edge_event.constrained_edge.p&&(d.markConstrainedEdgeByPoints(b,c),f.markConstrainedEdgeByPoints(b,c),o(a,d),o(a,f));else{var j=O(c,g,b);d=E(a,j,d,f,e,g),D(a,b,c,d,e)}else{G(a,b,c,d,f,F(b,c,f,g)),i(a,b,c,d,e)}}function E(a,b,c,d,e,f){var g;return b===N.CCW?(g=d.edgeIndex(e,f),d.delaunay_edge[g]=!0,o(a,d),d.clearDelaunayEdges(),c):(g=c.edgeIndex(e,f),c.delaunay_edge[g]=!0,o(a,c),c.clearDelaunayEdges(),d)}function F(a,b,c,d){var e=O(b,d,a);if(e===N.CW)return c.pointCCW(d);if(e===N.CCW)return c.pointCW(d);throw new I("poly2tri [Unsupported] nextFlipPoint: opposing point on constrained edge!",[b,d,a])}function G(a,b,c,d,e,f){var g=e.neighborAcross(f);H(g,"FLIP failed due to missing triangle");var h=g.oppositePoint(e,f);if(P(c,d.pointCCW(c),d.pointCW(c),h))D(a,c,h,g,h);else{G(a,b,c,d,g,F(b,c,g,h))}}var H=a("./assert"),I=a("./pointerror"),J=a("./triangle"),K=a("./advancingfront").Node,L=a("./utils"),M=L.EPSILON,N=L.Orientation,O=L.orient2d,P=L.inScanArea,Q=L.isAngleObtuse;c.triangulate=d},{"./advancingfront":2,"./assert":3,"./pointerror":5,"./triangle":9,"./utils":10}],8:[function(a,b,c){"use strict";var d=a("./pointerror"),e=a("./point"),f=a("./triangle"),g=a("./sweep"),h=a("./advancingfront"),i=h.Node,j=function(a,b){if(this.p=a,this.q=b,a.y>b.y)this.q=a,this.p=b;else if(a.y===b.y)if(a.x>b.x)this.q=a,this.p=b;else if(a.x===b.x)throw new d("poly2tri Invalid Edge constructor: repeated points!",[a]);this.q._p2t_edge_list||(this.q._p2t_edge_list=[]),this.q._p2t_edge_list.push(this)},k=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};k.prototype.clear=function(){this.left_node=null,this.bottom_node=null,this.right_node=null,this.width=0,this.left_highest=!1};var l=function(){this.constrained_edge=null,this.right=!1},m=function(a,b){b=b||{},this.triangles_=[],this.map_=[],this.points_=b.cloneArrays?a.slice(0):a,this.edge_list=[],this.pmin_=this.pmax_=null,this.front_=null,this.head_=null,this.tail_=null,this.af_head_=null,this.af_middle_=null,this.af_tail_=null,this.basin=new k,this.edge_event=new l,this.initEdges(this.points_)};m.prototype.addHole=function(a){this.initEdges(a);var b,c=a.length;for(b=0;b<c;b++)this.points_.push(a[b]);return this},m.prototype.AddHole=m.prototype.addHole,m.prototype.addHoles=function(a){var b,c=a.length;for(b=0;b<c;b++)this.initEdges(a[b]);return this.points_=this.points_.concat.apply(this.points_,a),this},m.prototype.addPoint=function(a){return this.points_.push(a),this},m.prototype.AddPoint=m.prototype.addPoint,m.prototype.addPoints=function(a){return this.points_=this.points_.concat(a),this},m.prototype.triangulate=function(){return g.triangulate(this),this},m.prototype.getBoundingBox=function(){return{min:this.pmin_,max:this.pmax_}},m.prototype.getTriangles=function(){return this.triangles_},m.prototype.GetTriangles=m.prototype.getTriangles,m.prototype.front=function(){return this.front_},m.prototype.pointCount=function(){return this.points_.length},m.prototype.head=function(){return this.head_},m.prototype.setHead=function(a){this.head_=a},m.prototype.tail=function(){return this.tail_},m.prototype.setTail=function(a){this.tail_=a},m.prototype.getMap=function(){return this.map_},m.prototype.initTriangulation=function(){var a,b=this.points_[0].x,c=this.points_[0].x,d=this.points_[0].y,f=this.points_[0].y,g=this.points_.length;for(a=1;a<g;a++){var h=this.points_[a];h.x>b&&(b=h.x),h.x<c&&(c=h.x),h.y>d&&(d=h.y),h.y<f&&(f=h.y)}this.pmin_=new e(c,f),this.pmax_=new e(b,d);var i=.3*(b-c),j=.3*(d-f);this.head_=new e(b+i,f-j),this.tail_=new e(c-i,f-j),this.points_.sort(e.compare)},m.prototype.initEdges=function(a,b){var c,d=a.length,e=b?a.length-1:a.length;for(c=0;c<e;++c)this.edge_list.push(new j(a[c],a[(c+1)%d]))},m.prototype.getPoint=function(a){return this.points_[a]},m.prototype.addToMap=function(a){this.map_.push(a)},m.prototype.locateNode=function(a){return this.front_.locateNode(a.x)},m.prototype.createAdvancingFront=function(){var a,b,c,d=new f(this.points_[0],this.tail_,this.head_);this.map_.push(d),a=new i(d.getPoint(1),d),b=new i(d.getPoint(0),d),c=new i(d.getPoint(2)),this.front_=new h(a,c),a.next=b,b.next=c,b.prev=a,c.prev=b},m.prototype.removeNode=function(a){},m.prototype.mapTriangleToNodes=function(a){for(var b=0;b<3;++b)if(!a.getNeighbor(b)){var c=this.front_.locatePoint(a.pointCW(a.getPoint(b)));c&&(c.triangle=a)}},m.prototype.removeFromMap=function(a){var b,c=this.map_,d=c.length;for(b=0;b<d;b++)if(c[b]===a){c.splice(b,1);break}},m.prototype.meshClean=function(a){for(var b,c,d=[a];b=d.pop();)if(!b.isInterior())for(b.setInterior(!0),this.triangles_.push(b),c=0;c<3;c++)b.constrained_edge[c]||d.push(b.getNeighbor(c))},b.exports=m},{"./advancingfront":2,"./point":4,"./pointerror":5,"./sweep":7,"./triangle":9}],9:[function(a,b,c){"use strict";var d=a("./xy"),e=function(a,b,c){this.points_=[a,b,c],this.neighbors_=[null,null,null],this.interior_=!1,this.constrained_edge=[!1,!1,!1],this.delaunay_edge=[!1,!1,!1]},f=d.toString;e.prototype.toString=function(){return"["+f(this.points_[0])+f(this.points_[1])+f(this.points_[2])+"]"},e.prototype.getPoint=function(a){return this.points_[a]},e.prototype.GetPoint=e.prototype.getPoint,e.prototype.getPoints=function(){return this.points_},e.prototype.getNeighbor=function(a){return this.neighbors_[a]},e.prototype.containsPoint=function(a){var b=this.points_;return a===b[0]||a===b[1]||a===b[2]},e.prototype.containsEdge=function(a){return this.containsPoint(a.p)&&this.containsPoint(a.q)},e.prototype.containsPoints=function(a,b){return this.containsPoint(a)&&this.containsPoint(b)},e.prototype.isInterior=function(){return this.interior_},e.prototype.setInterior=function(a){return this.interior_=a,this},e.prototype.markNeighborPointers=function(a,b,c){var d=this.points_;if(a===d[2]&&b===d[1]||a===d[1]&&b===d[2])this.neighbors_[0]=c;else if(a===d[0]&&b===d[2]||a===d[2]&&b===d[0])this.neighbors_[1]=c;else{if(!(a===d[0]&&b===d[1]||a===d[1]&&b===d[0]))throw new Error("poly2tri Invalid Triangle.markNeighborPointers() call");this.neighbors_[2]=c}},e.prototype.markNeighbor=function(a){var b=this.points_;a.containsPoints(b[1],b[2])?(this.neighbors_[0]=a,a.markNeighborPointers(b[1],b[2],this)):a.containsPoints(b[0],b[2])?(this.neighbors_[1]=a,a.markNeighborPointers(b[0],b[2],this)):a.containsPoints(b[0],b[1])&&(this.neighbors_[2]=a,a.markNeighborPointers(b[0],b[1],this))},e.prototype.clearNeighbors=function(){this.neighbors_[0]=null,this.neighbors_[1]=null,this.neighbors_[2]=null},e.prototype.clearDelaunayEdges=function(){this.delaunay_edge[0]=!1,this.delaunay_edge[1]=!1,this.delaunay_edge[2]=!1},e.prototype.pointCW=function(a){var b=this.points_;return a===b[0]?b[2]:a===b[1]?b[0]:a===b[2]?b[1]:null},e.prototype.pointCCW=function(a){var b=this.points_;return a===b[0]?b[1]:a===b[1]?b[2]:a===b[2]?b[0]:null},e.prototype.neighborCW=function(a){return a===this.points_[0]?this.neighbors_[1]:a===this.points_[1]?this.neighbors_[2]:this.neighbors_[0]},e.prototype.neighborCCW=function(a){return a===this.points_[0]?this.neighbors_[2]:a===this.points_[1]?this.neighbors_[0]:this.neighbors_[1]},e.prototype.getConstrainedEdgeCW=function(a){return a===this.points_[0]?this.constrained_edge[1]:a===this.points_[1]?this.constrained_edge[2]:this.constrained_edge[0]},e.prototype.getConstrainedEdgeCCW=function(a){return a===this.points_[0]?this.constrained_edge[2]:a===this.points_[1]?this.constrained_edge[0]:this.constrained_edge[1]},e.prototype.getConstrainedEdgeAcross=function(a){return a===this.points_[0]?this.constrained_edge[0]:a===this.points_[1]?this.constrained_edge[1]:this.constrained_edge[2]},e.prototype.setConstrainedEdgeCW=function(a,b){a===this.points_[0]?this.constrained_edge[1]=b:a===this.points_[1]?this.constrained_edge[2]=b:this.constrained_edge[0]=b},e.prototype.setConstrainedEdgeCCW=function(a,b){a===this.points_[0]?this.constrained_edge[2]=b:a===this.points_[1]?this.constrained_edge[0]=b:this.constrained_edge[1]=b},e.prototype.getDelaunayEdgeCW=function(a){return a===this.points_[0]?this.delaunay_edge[1]:a===this.points_[1]?this.delaunay_edge[2]:this.delaunay_edge[0]},e.prototype.getDelaunayEdgeCCW=function(a){return a===this.points_[0]?this.delaunay_edge[2]:a===this.points_[1]?this.delaunay_edge[0]:this.delaunay_edge[1]},e.prototype.setDelaunayEdgeCW=function(a,b){a===this.points_[0]?this.delaunay_edge[1]=b:a===this.points_[1]?this.delaunay_edge[2]=b:this.delaunay_edge[0]=b},e.prototype.setDelaunayEdgeCCW=function(a,b){a===this.points_[0]?this.delaunay_edge[2]=b:a===this.points_[1]?this.delaunay_edge[0]=b:this.delaunay_edge[1]=b},e.prototype.neighborAcross=function(a){return a===this.points_[0]?this.neighbors_[0]:a===this.points_[1]?this.neighbors_[1]:this.neighbors_[2]},e.prototype.oppositePoint=function(a,b){var c=a.pointCW(b);return this.pointCW(c)},e.prototype.legalize=function(a,b){var c=this.points_;if(a===c[0])c[1]=c[0],c[0]=c[2],c[2]=b;else if(a===c[1])c[2]=c[1],c[1]=c[0],c[0]=b;else{if(a!==c[2])throw new Error("poly2tri Invalid Triangle.legalize() call");c[0]=c[2],c[2]=c[1],c[1]=b}},e.prototype.index=function(a){var b=this.points_;if(a===b[0])return 0;if(a===b[1])return 1;if(a===b[2])return 2;throw new Error("poly2tri Invalid Triangle.index() call")},e.prototype.edgeIndex=function(a,b){var c=this.points_;if(a===c[0]){if(b===c[1])return 2;if(b===c[2])return 1}else if(a===c[1]){if(b===c[2])return 0;if(b===c[0])return 2}else if(a===c[2]){if(b===c[0])return 1;if(b===c[1])return 0}return-1},e.prototype.markConstrainedEdgeByIndex=function(a){this.constrained_edge[a]=!0},e.prototype.markConstrainedEdgeByEdge=function(a){this.markConstrainedEdgeByPoints(a.p,a.q)},e.prototype.markConstrainedEdgeByPoints=function(a,b){var c=this.points_;b===c[0]&&a===c[1]||b===c[1]&&a===c[0]?this.constrained_edge[2]=!0:b===c[0]&&a===c[2]||b===c[2]&&a===c[0]?this.constrained_edge[1]=!0:(b===c[1]&&a===c[2]||b===c[2]&&a===c[1])&&(this.constrained_edge[0]=!0)},b.exports=e},{"./xy":11}],10:[function(a,b,c){"use strict";function d(a,b,c){var d=(a.x-c.x)*(b.y-c.y),e=(a.y-c.y)*(b.x-c.x),f=d-e;return f>-g&&f<g?h.COLLINEAR:f>0?h.CCW:h.CW}function e(a,b,c,d){return!((a.x-b.x)*(d.y-b.y)-(d.x-b.x)*(a.y-b.y)>=-g)&&!((a.x-c.x)*(d.y-c.y)-(d.x-c.x)*(a.y-c.y)<=g)}function f(a,b,c){var d=b.x-a.x,e=b.y-a.y;return d*(c.x-a.x)+e*(c.y-a.y)<0}var g=1e-12;c.EPSILON=g;var h={CW:1,CCW:-1,COLLINEAR:0};c.Orientation=h,c.orient2d=d,c.inScanArea=e,c.isAngleObtuse=f},{}],11:[function(a,b,c){"use strict";function d(a){return"("+a.x+";"+a.y+")"}function e(a){var b=a.toString();return"[object Object]"===b?d(a):b}function f(a,b){return a.y===b.y?a.x-b.x:a.y-b.y}function g(a,b){return a.x===b.x&&a.y===b.y}b.exports={toString:e,toStringBase:d,compare:f,equals:g}},{}]},{},[6])(6)}()}(),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.SectionExtension=function(a,b){Autodesk.Viewing.Extension.call(this,a,b),this.viewer=a,this.name="section",this.modes=["x","y","z","box"]},Autodesk.Viewing.Extensions.SectionExtension.prototype=Object.create(Autodesk.Viewing.Extension.prototype),Autodesk.Viewing.Extensions.SectionExtension.prototype.constructor=Autodesk.Viewing.Extensions.SectionExtension;var proto=Autodesk.Viewing.Extensions.SectionExtension.prototype;proto.load=function(){var a=this,b=this.viewer;if(Autodesk.Viewing.Private.injectCSS("extensions/Section/Section.min.css"),this.tool=new Autodesk.Viewing.Extensions.Section.SectionTool(b),b.toolController.registerTool(this.tool),this.sectionStyle=null,this.supportedStyles=["X","Y","Z","BOX"],b.getToolbar){b.getToolbar(!0)?this.onToolbarCreated():(this.onToolbarCreatedBinded=this.onToolbarCreated.bind(this),b.addEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded))}this.onResetBinded=this.onReset.bind(this),b.addEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.HOTKEYS_ID="Autodesk.Section.Hotkeys";var c=[{keycodes:[Autodesk.Viewing.KeyCode.ESCAPE],
onRelease:function(){return a.enableSectionTool(!1)}}];return b.getHotkeyManager().pushHotkeys(this.HOTKEYS_ID,c),!0},proto.unload=function(){var a=this.viewer;return a.getHotkeyManager().popHotkeys(this.HOTKEYS_ID),this.destroyUI(),a.removeEventListener(Autodesk.Viewing.RESET_EVENT,this.onResetBinded),this.onResetBinded=null,this.onToolbarCreatedBinded&&(a.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),a.toolController.deregisterTool(this.tool),this.tool=null,!0},proto.toggle=function(){if(this.isActive())this.enableSectionTool(!1);else{var a=this.sectionStyle||"X";this.setSectionStyle(a,!0)}return this.isActive()},proto.getSectionStyle=function(){return this.sectionStyle},proto.setSectionStyle=function(a,b){if(-1===this.supportedStyles.indexOf(a))return!1;var c=this.isActive(),d=this.sectionStyle!==a||!b;return this.sectionStyle=a,c&&d?this.tool.setSection(a):c||(this.enableSectionTool(!0),d?this.tool.setSection(a):this.tool.attachControl(!0)),!0},proto.setSectionFromPlane=function(a){if(a)this.deactivate(),this.tool.setSectionFromPlane(a),this.tool.attachControl(!1);else{this.tool.clearSection();var b=this.viewer.toolController.setIsLocked(!1);this.enableSectionTool(!1),this.viewer.toolController.setIsLocked(b)}},proto.enableSectionTool=function(a){var b=this.viewer.toolController,c=this.tool.isActive();return a&&!c?(b.activateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.ACTIVE),!0):!(a||!c)&&(b.deactivateTool("section"),this.sectionToolButton&&this.sectionToolButton.setState(Autodesk.Viewing.UI.Button.State.INACTIVE),!0)},proto.onToolbarCreated=function(){this.onToolbarCreatedBinded&&(this.viewer.removeEventListener(Autodesk.Viewing.TOOLBAR_CREATED_EVENT,this.onToolbarCreatedBinded),this.onToolbarCreatedBinded=null),this.createUI()},proto.onReset=function(){this.tool.resetSection()},proto.createUI=function(){var a=this.viewer,b=Autodesk.Viewing.UI;this.sectionToolButton=new b.ComboButton("toolbar-sectionTool"),this.sectionToolButton.setToolTip("Section analysis"),this.sectionToolButton.setIcon("adsk-icon-section-analysis"),this.createSubmenu(this.sectionToolButton);var c=a.getToolbar(!1),d=c.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(d){var e=d.getControl("toolbar-resetTool");e?d.addControl(this.sectionToolButton,{index:d.indexOf(e.getId())}):d.addControl(this.sectionToolButton,{index:0})}},proto.createSubmenu=function(a){function b(a,b){return function(){var c=a.getState(),e=function(){a instanceof f.ComboButton==!1?d.activate(b):(d.enableSectionTool(!0),d.tool.attachControl(!0))};c===f.Button.State.INACTIVE?(a.setState(f.Button.State.ACTIVE),Autodesk.Viewing.isMobileDevice()?setTimeout(e,1):e()):c===f.Button.State.ACTIVE&&(a.setState(f.Button.State.INACTIVE),d.deactivate()),d.sectionStyle=b}}function c(){var a=function(){var a=new THREE.Vector3;return function(b,c,d){return a.subVectors(b,c),a.lengthSq()<d}}(),b=new THREE.Vector3(1,0,0),f=new THREE.Vector3(0,1,0),g=new THREE.Vector3(0,0,1),h=e.autocam.getWorldRightVector(),i=e.autocam.getWorldUpVector(),j=e.autocam.getWorldFrontVector();a(i,b,1e-4)?d.sectionYButton.setIcon("adsk-icon-plane-x"):a(i,g,1e-4)?d.sectionYButton.setIcon("adsk-icon-plane-z"):d.sectionYButton.setIcon("adsk-icon-plane-y"),a(h,f,1e-4)?d.sectionXButton.setIcon("adsk-icon-plane-y"):a(h,g,1e-4)?d.sectionXButton.setIcon("adsk-icon-plane-z"):d.sectionXButton.setIcon("adsk-icon-plane-x"),a(j,b,1e-4)?d.sectionZButton.setIcon("adsk-icon-plane-x"):a(j,f,1e-4)?d.sectionZButton.setIcon("adsk-icon-plane-y"):d.sectionZButton.setIcon("adsk-icon-plane-z"),e.removeEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)}var d=this,e=this.viewer,f=Autodesk.Viewing.UI,g=this.sectionXButton=new f.Button("toolbar-sectionTool-x");g.setToolTip("Add X plane"),g.setIcon("adsk-icon-plane-x"),g.onClick=b(g,"x"),a.addControl(g);var h=this.sectionYButton=new f.Button("toolbar-sectionTool-y");h.setToolTip("Add Y plane"),h.setIcon("adsk-icon-plane-y"),h.onClick=b(h,"y"),a.addControl(h);var i=this.sectionZButton=new f.Button("toolbar-sectionTool-z");i.setToolTip("Add Z plane"),i.setIcon("adsk-icon-plane-z"),i.onClick=b(i,"z"),a.addControl(i);var j=this.sectionBoxButton=new f.Button("toolbar-sectionTool-box");j.setToolTip("Add box"),j.setIcon("adsk-icon-box"),j.onClick=b(j,"box"),a.addControl(j),e.addEventListener(Autodesk.Viewing.GEOMETRY_LOADED_EVENT,c)},proto.destroyUI=function(){var a=this.viewer,b=a.getToolbar(!1);if(b){var c=b.getControl(Autodesk.Viewing.TOOLBAR.MODELTOOLSID);if(c&&this.sectionToolButton){var d=c.getControl("toolbar-inspectSubMenu");d?d.removeControl(this.sectionToolButton.getId()):c.removeControl(this.sectionToolButton.getId()),this.sectionToolButton=null}}},proto.activate=function(a){if(!this.activeStatus||this.mode!==a){switch(this.enableSectionTool(!0),a){default:case"x":this.tool.setSection("X"),this.mode="x";break;case"y":this.tool.setSection("Y"),this.mode="y";break;case"z":this.tool.setSection("Z"),this.mode="z";break;case"box":this.tool.setSection("BOX"),this.mode="box"}return this.activeStatus=!0,!0}},proto.deactivate=function(){return this.activeStatus&&(this.enableSectionTool(!1),this.activeStatus=!1),!0},Autodesk.Viewing.Extensions.Section.SectionExtension=Autodesk.Viewing.Extensions.SectionExtension,Autodesk.Viewing.theExtensionManager.registerExtension("Autodesk.Section",Autodesk.Viewing.Extensions.SectionExtension),AutodeskNamespace("Autodesk.Viewing.Extensions.Section"),Autodesk.Viewing.Extensions.Section.tintColor={r:1,g:1,b:0},Autodesk.Viewing.Extensions.Section.tintIntensity=.2,Autodesk.Viewing.Extensions.Section.SectionTool=function(a){function b(){J||(w=new THREE.TransformControls(y.camera,y.canvas,"transrotate"),w.addEventListener("change",d),w.setSnap(Math.PI/2,Math.PI/36),x=new THREE.TransformControls(y.camera,y.canvas,"translate"),x.addEventListener("change",d),void 0===y.overlayScenes[H]&&y.createOverlayScene(H),y.addOverlay(H,w),y.addOverlay(H,x),a.addEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,e),a.addEventListener(Autodesk.Viewing.ISOLATE_EVENT,f),a.addEventListener(Autodesk.Viewing.HIDE_EVENT,f),a.addEventListener(Autodesk.Viewing.SHOW_EVENT,f),a.addEventListener(Autodesk.Viewing.FRAGMENTS_LOADED_EVENT,l),a.addEventListener(Autodesk.Viewing.CUTPLANES_CHANGE_EVENT,k),J=!0)}function c(){J&&(y.removeOverlay(H,w),w.removeEventListener("change",d),w=null,y.removeOverlay(H,x),x.removeEventListener("change",d),x=null,y.removeOverlayScene(H),a.removeEventListener(Autodesk.Viewing.CAMERA_CHANGE_EVENT,e),a.removeEventListener(Autodesk.Viewing.ISOLATE_EVENT,f),a.removeEventListener(Autodesk.Viewing.HIDE_EVENT,f),a.removeEventListener(Autodesk.Viewing.SHOW_EVENT,f),a.removeEventListener(Autodesk.Viewing.FRAGMENTS_LOADED_EVENT,l),J=!1)}function d(){y.invalidate(!1,!1,!0)}function e(){w&&w.update(),x&&x.update()}function f(){A&&1===E.length&&(n(!0),e(),i((new THREE.Plane).setComponents(E[0].x,E[0].y,E[0].z,E[0].w)))}function g(a){return a&&a.color||new THREE.Color(16777215)}function h(a,b){function c(a){p&&clearTimeout(p),p=0,i=a,q.length=0,r.length=0,l=null,s.length=0,m=-1,n=0,o=0}function d(){p=0;for(var e=performance.now()+a;performance.now()<e;){if(!g())return y.invalidate(!0,!0),void c(null);var f=q[n];0==o&&k&&delete k.dbIds[f],h(r[o],f,j,o+1>=r.length,!i||m>=i.length)}p=setTimeout(d,b)}function e(){if(i&&m<i.length)for(;++m<i.length;)if((l=i[m].getFragmentMap())&&(q.length=0,l.enumNodeChildren(i[m].getRootId(),function(a){q.push(a)},!0),q.length>0))return j=i[m],k=s.find(function(a){return a.model===j}),j;for(var a=0;a<s.length;++a)if(j=s[a].model,l=j.getFragmentMap()){q.length=0;var b;for(b in s[a].dbIds){var c=Number(b);isFinite(c)&&q.push(c)}if(q.length>0)return s.splice(0,a+1),k=null,!0}return j=null,k=null,s.length=0,!1}function f(){if(n>=q.length)return!1;for(;++n<q.length;){var a=q[n];if(!l.isNodeHidden(a)&&!l.isNodeOff(a)&&(r.length=0,l.enumNodeFragments(a,function(a){r.push(a)},!1),r.length>0))return!0}return!1}function g(){if(++o<r.length)return!0;for(o=0;;){if(f())return!0;if(!e())return!1;n=-1}}var h,i,j,k,l,m,n,o,p=0,q=[],r=[],s=[];a=a||15,b=b||0,this.start=function(a,b,e){c(a),h=e,e&&(b>=0?p=setTimeout(d,b):d())},this.loadedDbIds=function(a,c){if(h&&a&&c&&!(c.length<=0)){var e=s.find(function(b){return b.model===a});e||(e={model:a,dbIds:{}},s.push(e),a===j&&(k=e));var f=a.getFragmentList();c.forEach(function(a){var b=0|f.getDbIds(a);e.dbIds[b]=!0}),0==p&&(p=setTimeout(d,b))}}}function i(a){function b(a,b,c,d){var e=a.children.find(function(a){return a.modelId==b&&a.dbId==c});e&&(a.remove(e),e.geometry&&e.geometry.dispose(),d&&e.material&&e.material.dispose())}init_three_triangulator(),init_three_intersector();var c=y.sceneAfter.getObjectByName("section");c&&y.sceneAfter.remove(c);var d=new THREE.Object3D;d.name="section",y.sceneAfter.add(d);var e=new THREE.Object3D;d.add(e);var f=new THREE.Object3D;d.add(f);var h=Autodesk.Viewing.Private,i=h.Intersector.makePlaneBasis(a),j=(new THREE.Matrix4).getInverse(i),k=y.matman().create2DMaterial(null,{skipCircles:!0,skipEllipticals:!0},!1,!1),l=y.matman().findMaterial(null,k);l.transparent=!0,l.depthTest=!0,l.polygonOffset=!0,l.polygonOffsetFactor=-1,l.polygonOffsetUnits=.1,l.cutplanes=P;var m,n=new THREE.Box3,o=y.modelQueue().getModels(),p=[];N.start(o,50,function(c,d,k,o,q){var r=k.getFragmentList();if(r.getWorldBounds(c,n),h.Intersector.intersectBoxPlane(a,n)){var s=r.getVizmesh(c);s.geometry&&!s.geometry.is2d&&!s.geometry.isLines&&s.material.cutplanes&&(m=s.material,h.Intersector.intersectMeshPlane(a,s,p))}if(o){if(p.length){var t=new THREE.Box3;h.Intersector.convertToPlaneCoords(i,p,t);var u=new h.VertexBufferBuilder(!1,8*p.length),v=g(m),w=0|.25*v.r*255.5,x=0|.25*v.g*255.5,z=0|.25*v.b*255.5,A=4278190080|z<<16|x<<8|w,B=new h.Triangulator.ContourSet(p,t);B.snapEdges(),B.sanitizeEdges(),B.stitchContours();var C;for(C=0;C<B.contours.length;C++){var D=B.contours[C];w=0|255.5*Math.random(),x=0|255.5*Math.random(),z=0|255.5*Math.random();for(var E=1;E<D.length;E++){var F=B.pts[D[E-1]],G=B.pts[D[E]];u.addSegment(F.x,F.y,G.x,G.y,0,.02,A,d,0)}}var H={mesh:u.toMesh()};h.BufferGeometryUtils.meshToGeometry(H);var I=H.geometry;I.streamingDraw=!0,I.streamingIndex=!0,q&&b(f,k.id,d,!1);var J=new THREE.Mesh(I,l);J.matrix.copy(j),J.matrixAutoUpdate=!1,J.frustumCulled=!1,J.modelId=k.id,J.dbId=d,f.add(J);var K=new h.Triangulator.TriangulatedSurface(B);if(K.indices.length){var L=new THREE.BufferGeometry,M=new Float32Array(3*K.pts.length);for(C=0;C<K.pts.length;C++)M[3*C]=K.pts[C].x,M[3*C+1]=K.pts[C].y,M[3*C+2]=0;L.addAttribute("position",new THREE.BufferAttribute(M,3));var N=m.packedNormals,O=N?new Uint16Array(2*K.pts.length):new Float32Array(3*K.pts.length);for(C=0;C<K.pts.length;C++)if(N){var Q=.5*(0/Math.PI+1);O[2*C]=65535*Q|0,O[2*C+1]=65535}else O[3*C]=0,O[3*C+1]=0,O[3*C+2]=1;L.addAttribute("normal",new THREE.BufferAttribute(O,N?2:3)),N&&(L.attributes.normal.bytesPerItem=2,L.attributes.normal.normalize=!0);var R=new Uint16Array(K.indices.length);R.set(K.indices),L.addAttribute("index",new THREE.BufferAttribute(R,1)),L.streamingDraw=!0,L.streamingIndex=!0;var S=y.matman().cloneMaterial(m,k);S.packedNormals=N,S.cutplanes=P,S.side=THREE.FrontSide,S.depthTest=!0,S.map=null,S.bumpMap=null,S.normalMap=null,S.alphaMap=null,S.specularMap=null,S.transparent=!1,S.depthWrite=!0,S.hatchPattern=!0,S.needsUpdate=!0;var T=(m.id+2)*Math.PI*.125,U=Math.tan(T);S.hatchParams=new THREE.Vector2(U,10),S.hatchTintColor=Autodesk.Viewing.Extensions.Section.tintColor,S.hatchTintIntensity=Autodesk.Viewing.Extensions.Section.tintIntensity,null!=S.prismType&&(S.defines={},S.defines[S.prismType.toUpperCase()]="","PrismWood"==S.prismType&&(S.defines.NO_UVW="")),q&&b(e,k.id,d,!0);var V=new THREE.Mesh(L,S);V.matrix.copy(j),V.matrixAutoUpdate=!1,V.modelId=k.id,V.dbId=d,V.fragId=p.fragId,e.add(V)}}p.length=0}})}function j(){var a=y.sceneAfter.getObjectByName("section");a&&a.traverse(function(a){!a instanceof THREE.Mesh||!a.material||(a.material.needsUpdate=!0)})}function k(a){var b=P.length;P.length=0;for(var c=y.getCutPlaneSets(),d=0;d<c.length;d++){var e=c[d];if(e!==O)for(var f=y.getCutPlaneSet(e),g=0;g<f.length;g++)P.push(f[g])}b!==P.length&&j()}function l(a){A&&1===E.length&&N.loadedDbIds(a.model,a.getFragIds())}function m(a,b){var c,d,e=(new THREE.Quaternion).setFromUnitVectors(new THREE.Vector3(0,0,1),a.normal);if(b){var f=a.projectPoint(b.max),g=a.projectPoint(b.min),h=e.clone().inverse();f.applyQuaternion(h),g.applyQuaternion(h),d=(new THREE.Vector3).subVectors(f,g),c=new THREE.PlaneBufferGeometry(d.x,d.y)}else b=y.getVisibleBounds(),d=2*b.getBoundingSphere().radius,c=new THREE.PlaneBufferGeometry(d,d);var i=new THREE.MeshBasicMaterial({opacity:0,color:16777215,side:THREE.DoubleSide,depthTest:!1,depthWrite:!1,transparent:!0}),j=new M.SectionMesh(c,i,a),k=a.projectPoint(b.center());j.position.copy(k),j.quaternion.multiply(e);var l=y.currentLightPreset();l=Math.max(0,l);for(var m=Autodesk.Viewing.Private.LightPresets[l].bgColorGradient,n="rgb("+(255-m[0])+","+(255-m[1])+","+(255-m[2])+")",o=new THREE.LineBasicMaterial({color:n,linewidth:1,depthTest:!1}),p=j.geometry.getAttribute("position"),q=0;q<L.length;q++){c=new THREE.Geometry,c.vertices.push((new THREE.Vector3).fromArray(p.array,L[q][0]*p.itemSize),(new THREE.Vector3).fromArray(p.array,L[q][1]*p.itemSize));var r=new THREE.Line(c,o);j.add(r),j.outlines.push(r)}return j}function n(a){o(function(b){if(b instanceof M.SectionMesh){var c,d,e,f;if(b.connectivity.length>0){var g=(new THREE.Matrix4).getInverse(b.matrixWorld);for(f=new THREE.Vector3,e=b.geometry.getAttribute("position"),c=0;c<e.length/e.itemSize;c++){var h=b.connectivity[c];null!==Q(b.plane,h[0],h[1],f)&&(f.applyMatrix4(g),e.setXYZ(c,f.x,f.y,f.z))}for(e.needsUpdate=!0,b.geometry.computeBoundingBox(),b.geometry.computeBoundingSphere(),c=0;c<b.outlines.length;c++)d=b.outlines[c],d.geometry.vertices[0].fromArray(e.array,L[c][0]*e.itemSize),d.geometry.vertices[1].fromArray(e.array,L[c][1]*e.itemSize),d.geometry.verticesNeedUpdate=!0}else if(a){var i=y.getVisibleBounds(),j=2*i.getBoundingSphere().radius;for(f=b.plane.projectPoint(i.center()),b.geometry=new THREE.PlaneBufferGeometry(j,j),b.position.copy(f),e=b.geometry.getAttribute("position"),c=0;c<b.outlines.length;c++)d=b.outlines[c],d.geometry.vertices[0].fromArray(e.array,L[c][0]*e.itemSize),d.geometry.vertices[1].fromArray(e.array,L[c][1]*e.itemSize),d.geometry.verticesNeedUpdate=!0}}})}function o(a){for(var b=0;b<D.length;b++)D[b].traverse(a)}function p(){o(function(a){a instanceof M.SectionMesh&&a.update()}),1===E.length&&i((new THREE.Plane).setComponents(E[0].x,E[0].y,E[0].z,E[0].w)),y.setCutPlaneSet(O,E)}function q(a){for(var b=0;b<D.length;b++)D[b].visible=a;C!==a&&d(),C=a}function r(a){a&&E.length>0&&(1===E.length&&i((new THREE.Plane).setComponents(E[0].x,E[0].y,E[0].z,E[0].w)),y.setCutPlaneSet(O,E)),q(a)}function s(a,b){a.attach(b),a.setPosition(b.position),a.visible=!0}function t(a){return y.api.navigation.getEyeVector().dot(a)>0&&a.negate(),a}function u(a,b){var c=y.getVisibleBounds(),d=c.center(),e=new THREE.Group;b=void 0!==b?b:-1*d.dot(a);var f=new THREE.Plane(a,b),g=m(f,null);e.add(g),E.push(g.planeVec),D.push(e),y.addOverlay(H,e),w&&(s(w,g),w.showRotationGizmos(!0),F=w.getPicker()),p()}function v(){var a,b,c=[new THREE.Vector3(1,0,0),new THREE.Vector3(0,1,0),new THREE.Vector3(0,0,1),new THREE.Vector3(-1,0,0),new THREE.Vector3(0,-1,0),new THREE.Vector3(0,0,-1)],d=[[[1,2],[1,5],[2,4],[4,5]],[[3,5],[0,5],[2,3],[0,2]],[[1,3],[0,1],[3,4],[0,4]],[[1,5],[1,2],[4,5],[2,4]],[[2,3],[0,2],[3,5],[0,5]],[[0,1],[3,1],[0,4],[3,4]]],e=new THREE.Group,f=y.getVisibleBounds(),g=f.center(),h=new THREE.Box3(f.min,g),i=[],j=[];for(a=0;a<c.length;a++){var k=new THREE.Plane(c[a],-1*g.dot(c[a]));if(i.push(k),a>2){var l=k.orthoPoint(h.max),n=k.orthoPoint(h.min),o=(new THREE.Vector3).subVectors(l,n);k.constant-=o.length()}b=m(k,h),e.add(b),j.push(b),E.push(b.planeVec)}for(a=0;a<j.length;a++){b=j[a];for(var q=d[a],r=0;r<q.length;r++){for(var t=[],u=q[r],v=0;v<u.length;v++)t.push(i[u[v]]);b.connectivity.push(t)}}D.push(e),y.addOverlay(H,e),s(w,D[0].children[0]),s(x,D[0]),w.showRotationGizmos(!1),F=w.getPicker().concat(x.getPicker()),p()}var w,x,y=a.impl,z=["section"],A=!1,B=!1,C=!0,D=[],E=[],F=[],G="",H="gizmo",I=null,J=!1,K=!0,L=[[0,1],[1,3],[3,2],[2,0]],M=Autodesk.Viewing.Extensions.Section;init_TransformGizmos(),init_SectionMesh();var N=new h,O="Autodesk.Viewing.Extension.Section.SectionTool";y.setCutPlaneSetFor2DRendering(O);var P=[],Q=function(){var a=new THREE.Matrix3,b=new THREE.Vector3,c=new THREE.Vector3,d=new THREE.Vector3;return function(e,f,g,h){a.set(e.normal.x,e.normal.y,e.normal.z,f.normal.x,f.normal.y,f.normal.z,g.normal.x,g.normal.y,g.normal.z);var i=a.determinant();return 0===i?null:(b.crossVectors(f.normal,g.normal).multiplyScalar(-e.constant),c.crossVectors(g.normal,e.normal).multiplyScalar(-f.constant),d.crossVectors(e.normal,f.normal).multiplyScalar(-g.constant),(h||new THREE.Vector3).copy(b).add(c).add(d).divideScalar(i))}}(),R=function(a,b,c){return THREE.TransformControls.intersectObjects(a.canvasX,a.canvasY,b,y.camera,c)};this.isActive=function(){return A},this.setSection=function(a){this.clearSection();var b;switch(a){case"X":b=new THREE.Vector3(1,0,0),u(t(b));break;case"Y":b=new THREE.Vector3(0,1,0),u(t(b));break;case"Z":b=new THREE.Vector3(0,0,1),u(t(b));break;case"BOX":v()}G=a},this.setSectionFromPlane=function(a){this.clearSection(),u(new THREE.Vector3(a.x,a.y,a.z),a.w),G=""},this.clearSection=function(){for(w&&w.detach(),x&&x.detach();E.length>0;)E.pop();for(;D.length>0;){var a=D.pop();y.removeOverlay(H,a)}N.start(null);var b=y.sceneAfter.getObjectByName("section");b&&y.sceneAfter.remove(b),y.setCutPlaneSet(O)},this.isPlaneOn=function(){return C},this.showPlane=function(a){q(a)},this.attachControl=function(a){w&&x&&(a?(s(w,D[0].children[0]),w.highlight(),"BOX"===G&&s(x,D[0])):(w.detach(),x.detach()))},this.resetSection=function(){this.setSection(G)},this.getNames=function(){return z},this.getName=function(){return z[0]},this.register=function(){},this.deregister=function(){this.clearSection(),c()},this.getPriority=function(){return 70},this.activate=function(){b(),A=!0,B=!1,K=!0,E=E||[],r(!0)},this.deactivate=function(){A=!1,B=!1,N.start(null);var a=y.sceneAfter.getObjectByName("section");a&&y.sceneAfter.remove(a),r(!1),y.setCutPlaneSet(O),w.detach(),x.detach()},this.update=function(){return!1},this.handleSingleClick=function(a){var b=a.pointers?a.pointers[0]:a,c=R(b,D[0].children);return c&&(s(w,c.object),w.highlight(),d()),!1},this.handleDoubleClick=function(){return!1},this.handleSingleTap=function(a){return this.handleSingleClick(a,0)},this.handleDoubleTap=function(){return!1},this.handleKeyDown=function(){return!1},this.handleKeyUp=function(){return!1},this.handleWheelInput=function(){return!1},this.handleButtonDown=function(a){return B=!0,!!x.onPointerDown(a)||w.onPointerDown(a)},this.handleButtonUp=function(a){return B=!1,!!x.onPointerUp(a)||w.onPointerUp(a)},this.handleMouseMove=function(a){if(B){if(x.onPointerMove(a))return p(),w.update(),!0;if(w.onPointerMove(a))return p(),n(),!0}if(x.visible=void 0!==x.object,"touch"!==a.pointerType){var b=a.pointers?a.pointers[0]:a,c=R(b,D[0].children);c&&(K=!1);var d=!!(K||c||R(b,F,!0));w.visible=d,x.visible=x.visible&&d,q(d)}return!!x.onPointerHover(a)||w.onPointerHover(a)},this.handleGesture=function(a){switch(a.type){case"dragstart":return I="drag",this.handleButtonDown(a,0);case"dragmove":return"drag"===I&&this.handleMouseMove(a);case"dragend":return"drag"===I&&(I=null,this.handleButtonUp(a,0))}return!1},this.handleBlur=function(){return!1},this.handleResize=function(){},this.handlePressHold=function(){return!0}};
//# sourceMappingURL=Section.min.js.map